(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"OZ/3":function(t,e){},aCzL:function(t,e,i){"use strict";i.r(e);var n=i("ofXK"),o=i("3Pt+"),s=i("tyNb"),c=i("THE0"),a=i("C/ya"),r=i("D/9M"),d=i("g+Po"),l=i("fXoL"),h=i("OaWH"),m=i("0IaG"),u=i("BAfr"),b=i("m6yr"),p=i("47y3");const f=function(){return{class:"backoffice-publish"}},g=function(t,e){return{id:"applications",name:"Applications",count:t,icon:e}},_=function(){return{class:"backoffice-lock-open"}},v=function(t,e){return{id:"authentication",name:"Authentication",count:t,icon:e}},w=function(){return{class:"backoffice-users"}},y=function(t,e){return{id:"users",name:"Users",count:t,icon:e}},O=function(t,e,i){return[t,e,i]};let C=(()=>{class t extends a.a{constructor(t,e,i,n){super(t,e,i),this._service=t,this._route=e,this._router=i,this._dialog=n,this.service=this._service.Domains}ngOnInit(){super.ngOnInit(),this._service.title="Domains"}loadValues(){let t={offset:0,limit:1,owner:this.item.id};this._service.Applications.query(t).then(t=>this.applications=this._service.Applications.last_total||t.length||0),t={offset:0,limit:1,authority_id:this.item.id},this._service.Users.query(t).then(t=>this.user_count=this._service.Users.last_total||t.length||0)}newItem(){this.modal_ref||(this.modal_ref=this._dialog.open(r.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new c.d(this._service.Domains,{}),service:this._service.Domains}}),this.subscription("modal_events",this.modal_ref.componentInstance.event.subscribe(t=>{"done"===t.reason&&this._router.navigate(["/domains",t.metadata.item.id])})),this.modal_ref.afterClosed().subscribe(()=>{this.unsub("modal_events"),this.modal_ref=null}))}editItem(){this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(r.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Domains}}),this.modal_ref.afterClosed().subscribe(()=>{this.unsub("modal_events"),this.modal_ref=null}))}deleteItem(){this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(d.b,Object.assign(Object.assign({},d.a),{data:{title:"Delete domain",content:"<p>Are you sure you want delete this domain?</p><p>The domain will be deleted <strong>immediately.</strong></p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("delete_confirm",this.modal_ref.componentInstance.event.subscribe(t=>{"done"===t.reason&&(this.modal_ref.componentInstance.loading="Deleting domain...",this.item.delete().then(()=>{this._service.notifySuccess(`Successfully deleted domain "${this.item.name}".`),this._router.navigate(["/users"]),this._service.set("BACKOFFICE.removed",this.item.id),this.modal_ref.close()},t=>{this.modal_ref.componentInstance.loading=null,this._service.notifyError(`Error deleting domain. Error: ${JSON.stringify(t.response||t.message||t)}`)}))})),this.modal_ref.afterClosed().subscribe(()=>{this.unsub("modal_events"),this.modal_ref=null}))}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(h.a),l.Rb(s.a),l.Rb(s.c),l.Rb(m.b))},t.\u0275cmp=l.Lb({type:t,selectors:[["app-domains"]],features:[l.Ab],decls:5,vars:22,consts:[[1,"container"],[1,"sidebar"],["heading","Domains",3,"module","close","event"],[3,"touchrelease"],["name","domain","route","domains",3,"item","tabs","event"]],template:function(t,e){1&t&&(l.Xb(0,"div",0),l.Xb(1,"div",1),l.Xb(2,"sidebar",2),l.fc("event",(function(t){return e.sidebarEvent(t)})),l.Wb(),l.Wb(),l.Xb(3,"main",3),l.fc("touchrelease",(function(){return e.show_sidebar=!1})),l.Xb(4,"item-display",4),l.fc("event",(function(t){return e.itemEvent(t)})),l.Wb(),l.Wb(),l.Wb()),2&t&&(l.Hb("show",e.show_sidebar),l.Db(2),l.pc("module",e.module)("close",e.show_sidebar),l.Db(2),l.pc("item",e.item)("tabs",l.tc(18,O,l.sc(7,g,e.applications||0,l.qc(6,f)),l.sc(11,v,e.auth_sources||0,l.qc(10,_)),l.sc(15,y,e.user_count||0,l.qc(14,w)))))},directives:[u.a,b.b,p.a],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}@media only screen and (orientation:landscape) and (max-width:800px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;flex:1;background-color:#f0f0f0}@media only screen and (orientation:portrait) and (max-width:450px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}"]}),t})();var W=i("5f3J"),X=i("bTqV"),A=i("Qu3c"),x=i("0njA");const P=function(){return{class:"backoffice-edit"}},M=function(){return{class:"backoffice-trash"}};function I(t,e){if(1&t){const t=l.Yb();l.Xb(0,"tr"),l.Xb(1,"td",12),l.Kc(2),l.Wb(),l.Xb(3,"td",8),l.Xb(4,"a",13),l.Kc(5),l.Wb(),l.Wb(),l.Xb(6,"td",9),l.Kc(7),l.Wb(),l.Xb(8,"td",10),l.Xb(9,"button",14),l.fc("tapped",(function(){l.Ac(t);const i=e.$implicit;return l.jc(3).editApplication(i)})),l.Sb(10,"app-icon",15),l.Wb(),l.Xb(11,"button",14),l.fc("tapped",(function(){l.Ac(t);const i=e.$implicit;return l.jc(3).deleteApplication(i)})),l.Sb(12,"app-icon",15),l.Wb(),l.Wb(),l.Wb()}if(2&t){const t=e.$implicit;l.Db(1),l.pc("matTooltip",t.id),l.Db(1),l.Lc(t.name),l.Db(2),l.pc("href",t.redirect_uri,l.Dc),l.Db(1),l.Lc(t.redirect_uri),l.Db(2),l.Lc(t.scopes),l.Db(3),l.pc("icon",l.qc(7,P)),l.Db(2),l.pc("icon",l.qc(8,M))}}function D(t,e){if(1&t&&(l.Xb(0,"div",6),l.Xb(1,"table"),l.Xb(2,"thead"),l.Xb(3,"td",7),l.Kc(4,"Name"),l.Wb(),l.Xb(5,"td",8),l.Kc(6,"Redirect"),l.Wb(),l.Xb(7,"td",9),l.Kc(8,"Scope"),l.Wb(),l.Sb(9,"td",10),l.Wb(),l.Xb(10,"tbody"),l.Ic(11,I,13,9,"tr",11),l.Wb(),l.Wb(),l.Wb()),2&t){const t=l.jc(2);l.Db(11),l.pc("ngForOf",t.application_list)}}function S(t,e){1&t&&(l.Xb(0,"div",16),l.Xb(1,"div",17),l.Kc(2,"No applications found"),l.Wb(),l.Wb())}function k(t,e){if(1&t){const t=l.Yb();l.Xb(0,"div",1),l.Xb(1,"section",2),l.Xb(2,"button",3),l.fc("tapped",(function(){return l.Ac(t),l.jc().newApplication()})),l.Kc(3,"Add new"),l.Wb(),l.Wb(),l.Xb(4,"section"),l.Ic(5,D,12,1,"div",4),l.Ic(6,S,3,0,"div",5),l.Wb(),l.Wb()}if(2&t){const t=l.jc();l.Db(5),l.pc("ngIf",t.application_list&&t.application_list.length>0),l.Db(1),l.pc("ngIf",!t.application_list||t.application_list.length<=0)}}let K=(()=>{class t extends W.a{constructor(t,e){super(),this._service=t,this._dialog=e}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadApplications()}))}ngOnChanges(t){t.item&&this.loadApplications()}loadApplications(t=0){this.item&&this._service.Applications.query({authority:this.item.id,offset:t}).then(e=>{t||(this.application_list=[]);for(const t of e||[]){let e=!1;for(const i of this.application_list)if(i.id===t.id){e=!0;break}e||this.application_list.push(t)}},()=>null)}newApplication(){this._dialog.open(r.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new c.b(this._service.Applications,{}),service:this._service.Applications}})}editApplication(t){this.item&&this._dialog.open(r.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:t,service:this._service.Applications}})}deleteApplication(t){if(t){const e=this._dialog.open(d.b,Object.assign(Object.assign({},d.a),{data:{title:"Delete application",content:`<p>Are you sure you want delete the application ${t.name}?</p><p>Configuration will be <strong>immediately</strong> updated</p>`,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",e.componentInstance.event.subscribe(i=>{"done"===i.reason&&(e.componentInstance.loading="Deleting application...",t.delete().then(()=>{this._service.notifySuccess(`Successfully deleted application "${t.name}".`),this.loadApplications(),e.close(),this.unsub("delete_confirm")},t=>{e.componentInstance.loading=null,this._service.notifyError(`Error deleting application. Error: ${JSON.stringify(t.response||t.message||t)}`)}))}))}}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(h.a),l.Rb(m.b))},t.\u0275cmp=l.Lb({type:t,selectors:[["domain-applications"]],inputs:{item:"item"},features:[l.Ab,l.Bb],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"select"],["mat-button","",3,"tapped"],["class","list",4,"ngIf"],["class","info-block",4,"ngIf"],[1,"list"],[1,"name"],[1,"flex"],[1,"scope"],[1,"duo"],[4,"ngFor","ngForOf"],[1,"name",3,"matTooltip"],[3,"href"],["mat-icon-button","",3,"tapped"],[3,"icon"],[1,"info-block"],[1,"text"]],template:function(t,e){1&t&&l.Ic(0,k,7,2,"div",0),2&t&&l.pc("ngIf",e.item)},directives:[n.m,X.b,b.b,n.l,A.a,x.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{display:flex;font-size:1.2em;max-width:5em;margin:0}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#d32f2f;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.duo[_ngcontent-%COMP%]{width:6.75em;display:flex}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]   .scope[_ngcontent-%COMP%]{width:8em;min-width:8em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}"]}),t})();i("OZ/3");var j=i("dQMc");const E=function(){return{class:"backoffice-edit"}},L=function(){return{class:"backoffice-trash"}};function F(t,e){if(1&t){const t=l.Yb();l.Xb(0,"tr"),l.Xb(1,"td",10),l.Kc(2),l.Wb(),l.Xb(3,"td",7),l.Kc(4),l.Wb(),l.Xb(5,"td",8),l.Xb(6,"button",11),l.fc("tapped",(function(){l.Ac(t);const i=e.$implicit;return l.jc(2).editAuthSource(i)})),l.Sb(7,"app-icon",12),l.Wb(),l.Xb(8,"button",11),l.fc("tapped",(function(){l.Ac(t);const i=e.$implicit;return l.jc(2).deleteAuthSource(i)})),l.Sb(9,"app-icon",12),l.Wb(),l.Wb(),l.Wb()}if(2&t){const t=e.$implicit,i=l.jc(2);l.Db(1),l.pc("matTooltip",t.id),l.Db(1),l.Lc(t.name),l.Db(2),l.Lc(i.source_types[t.id]),l.Db(3),l.pc("icon",l.qc(5,E)),l.Db(2),l.pc("icon",l.qc(6,L))}}function q(t,e){if(1&t&&(l.Xb(0,"div",5),l.Xb(1,"table"),l.Xb(2,"thead"),l.Xb(3,"td",6),l.Kc(4,"Name"),l.Wb(),l.Xb(5,"td",7),l.Kc(6,"Type"),l.Wb(),l.Sb(7,"td",8),l.Wb(),l.Xb(8,"tbody"),l.Ic(9,F,10,7,"tr",9),l.Wb(),l.Wb(),l.Wb()),2&t){const t=l.jc();l.Db(9),l.pc("ngForOf",t.auth_sources)}}function T(t,e){1&t&&(l.Xb(0,"div",13),l.Xb(1,"div",14),l.Kc(2,"No authentication sources found"),l.Wb(),l.Wb())}function $(t,e){if(1&t&&(l.Xb(0,"tr"),l.Xb(1,"td",8),l.Kc(2),l.Wb(),l.Xb(3,"td",5),l.Kc(4),l.Wb(),l.Xb(5,"td",6),l.Kc(6),l.Wb(),l.Wb()),2&t){const t=e.$implicit;l.Db(1),l.pc("matTooltip",t.id),l.Db(1),l.Lc(t.name),l.Db(2),l.Lc(t.email),l.Db(2),l.Lc(t.role)}}function N(t,e){if(1&t&&(l.Xb(0,"div",3),l.Xb(1,"table"),l.Xb(2,"thead"),l.Xb(3,"td",4),l.Kc(4,"Name"),l.Wb(),l.Xb(5,"td",5),l.Kc(6,"Email"),l.Wb(),l.Xb(7,"td",6),l.Kc(8,"Role"),l.Wb(),l.Wb(),l.Xb(9,"tbody"),l.Ic(10,$,7,4,"tr",7),l.Wb(),l.Wb(),l.Wb()),2&t){const t=l.jc();l.Db(10),l.pc("ngForOf",t.model.list)}}function R(t,e){1&t&&(l.Xb(0,"div",9),l.Xb(1,"div",10),l.Kc(2,"No users found"),l.Wb(),l.Wb())}const B=[{path:":id",component:C,children:[{path:"applications",component:K},{path:"authentication",component:(()=>{class t extends W.a{constructor(t,e){super(),this._service=t,this._dialog=e,this.auth_sources=[],this.source_types={}}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadAuthSources()}))}ngOnChanges(t){t.item&&this.loadAuthSources()}loadAuthSources(t=0){this.item&&Promise.all([this._service.OAuthSources.query({authority_id:this.item.id,offset:t}),this._service.SAMLAuthSources.query({authority_id:this.item.id,offset:t}),this._service.LDAPAuthSources.query({authority_id:this.item.id,offset:t})]).then(e=>{t||(this.auth_sources=[]);for(const t of e)t.forEach(t=>this.addAuthSourceToList(t))},()=>null)}newAuthSource(){this._dialog.open(j.a,{width:"auto",height:"auto",data:{domain:this.item}}).afterClosed().subscribe(()=>this.loadAuthSources())}editAuthSource(t){this._dialog.open(j.a,{width:"auto",height:"auto",data:{domain:this.item,auth_source:t}}).afterClosed().subscribe(()=>this.loadAuthSources())}deleteAuthSource(t){if(t){const e=this._dialog.open(d.b,Object.assign(Object.assign({},d.a),{data:{title:"Delete auth source",content:"<p>Are you sure you want delete this auth source?</p><p>Deleting this will remove this auth source <strong>immediately</strong></p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",e.componentInstance.event.subscribe(i=>{"done"===i.reason&&(e.componentInstance.loading="Deleting auth source...",t.delete().then(()=>{this._service.notifySuccess("Successfully deleted auth source."),e.close(),this.unsub("delete_confirm"),this.loadAuthSources()},t=>{this._service.notifyError(`Error deleting auth source. Error ${JSON.stringify(t.response||t.message||t)}`),e.componentInstance.loading=null}))}))}}addAuthSourceToList(t){this.source_types[t.id]=t instanceof c.l?"saml":t instanceof c.g?"ldap":"oauth";const e=this.auth_sources.findIndex(e=>e.id===t.id);e<0?this.auth_sources.push(t):this.auth_sources.splice(e,1,t)}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(h.a),l.Rb(m.b))},t.\u0275cmp=l.Lb({type:t,selectors:[["domain-authentication"]],inputs:{item:"item"},features:[l.Ab,l.Bb],decls:8,vars:2,consts:[[1,"container"],[1,"select"],["mat-button","",3,"tapped"],["class","list",4,"ngIf","ngIfElse"],["no_auth_sources",""],[1,"list"],[1,"name"],[1,"flex"],[1,"duo"],[4,"ngFor","ngForOf"],[1,"name",3,"matTooltip"],["mat-icon-button","",3,"tapped"],[3,"icon"],[1,"info-block"],[1,"text"]],template:function(t,e){if(1&t&&(l.Xb(0,"div",0),l.Xb(1,"section",1),l.Xb(2,"button",2),l.fc("tapped",(function(){return e.newAuthSource()})),l.Kc(3,"Add new"),l.Wb(),l.Wb(),l.Xb(4,"section"),l.Ic(5,q,10,1,"div",3),l.Wb(),l.Wb(),l.Ic(6,T,3,0,"ng-template",null,4,l.Jc)),2&t){const t=l.xc(7);l.Db(5),l.pc("ngIf",e.auth_sources&&e.auth_sources.length>0)("ngIfElse",t)}},directives:[X.b,b.b,n.m,n.l,A.a,x.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{display:flex;font-size:1.2em;max-width:5em;margin:0}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:8em;min-width:8em}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#d32f2f;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}.duo[_ngcontent-%COMP%]{width:6em;text-align:right}"]}),t})()},{path:"users",component:(()=>{class t extends W.a{constructor(t){super(),this._service=t,this.model={}}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadUsers()})),this.loadUsers()}ngOnChanges(t){t.item&&this.loadUsers()}loadUsers(t=0){this.item&&this._service.Users.query({authority_id:this.item.id,offset:t}).then(e=>{t||(this.model.list=[]);for(const t of e||[]){let e=!1;for(const i of this.model.list)if(i.id===t.id){e=!0;break}e||this.model.list.push(t)}},()=>null)}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(h.a))},t.\u0275cmp=l.Lb({type:t,selectors:[["domain-users"]],inputs:{item:"item"},features:[l.Ab,l.Bb],decls:4,vars:2,consts:[[1,"container"],["class","list",4,"ngIf"],["class","info-block",4,"ngIf"],[1,"list"],[1,"name"],[1,"flex"],[1,"role"],[4,"ngFor","ngForOf"],[1,"name",3,"matTooltip"],[1,"info-block"],[1,"text"]],template:function(t,e){1&t&&(l.Xb(0,"div",0),l.Xb(1,"section"),l.Ic(2,N,11,1,"div",1),l.Ic(3,R,3,0,"div",2),l.Wb(),l.Wb()),2&t&&(l.Db(2),l.pc("ngIf",e.model.list&&e.model.list.length>0),l.Db(1),l.pc("ngIf",!e.model.list||e.model.list.length<=0))},directives:[n.m,n.l,A.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{display:flex;font-size:1.2em;max-width:5em;margin:0}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:12em;min-width:12em}.table-row[_ngcontent-%COMP%]   .role[_ngcontent-%COMP%]{width:8em;min-width:8em}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#d32f2f;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}"]}),t})()},{path:"**",redirectTo:"applications"}]},{path:"**",redirectTo:"-"}];var U=i("PCNd");i.d(e,"AppDomainsModule",(function(){return H}));let H=(()=>{class t{}return t.\u0275mod=l.Pb({type:t}),t.\u0275inj=l.Ob({factory:function(e){return new(e||t)},imports:[[n.c,o.g,s.g.forChild(B),U.a]]}),t})()}}]);