(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{nSQh:function(e,t,n){"use strict";n.r(t);var i=n("ofXK"),s=n("3Pt+"),o=n("tyNb"),c=n("5+WD"),a=n("THE0"),r=n("C/ya"),d=n("D/9M"),l=n("g+Po"),b=n("fXoL"),m=n("OaWH"),g=n("0IaG"),h=n("BAfr"),u=n("m6yr"),f=n("47y3");const p=function(){return{class:"backoffice-info-with-circle"}},_=function(e){return{id:"about",name:"About",icon:e}},v=function(){return{class:"backoffice-tablet"}},y=function(e,t){return{id:"modules",name:"Modules",count:e,icon:t}},w=function(){return{class:"backoffice-layers"}},O=function(e,t){return{id:"zones",name:"Zones",count:e,icon:t}},x=function(){return{class:"backoffice-stopwatch"}},C=function(e,t){return{id:"triggers",name:"Triggers",count:e,icon:t}},M=function(e,t,n,i){return[e,t,n,i]};let P=(()=>{class e extends r.a{constructor(e,t,n,i){super(e,t,n),this._service=e,this._route=t,this._router=n,this._dialog=i,this.service=this._service.Systems}ngOnInit(){super.ngOnInit(),this._service.title="Systems"}loadValues(){this._service.Systems.listTriggers(this.item.id).then(e=>this.trigger_count=e.length||0),this.device_count=(this.item.modules||[]).length,this.zone_count=(this.item.zones||[]).length}newItem(e=!1){this.modal_ref||(this.modal_ref=this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:e?new a.p(Object.assign(Object.assign({},this.item),{id:"",name:`${this.item.name} (1)`})):new a.p,service:this._service.Systems}}),this.subscription("modal_events",this.modal_ref.componentInstance.event.subscribe(e=>{"done"===e.reason&&this._router.navigate(["/systems",e.metadata.item.id])})),this.modal_ref.afterClosed().subscribe(()=>{this.unsub("modal_events"),this.modal_ref=null}))}editItem(){console.log("Edit"),this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Systems}}),this.modal_ref.afterClosed().subscribe(()=>{this.unsub("modal_events"),this.modal_ref=null}))}deleteItem(){this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Delete system",content:"<p>Are you sure you want delete this system?</p><p>Deleting this will <strong>immediately</strong> delete modules that are not in another system</p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("modal_events",this.modal_ref.componentInstance.event.subscribe(e=>{"done"===e.reason&&(this.modal_ref.componentInstance.loading="Deleting system...",this.item.delete().then(()=>{this._service.notifySuccess(`Successfully deleted system "${this.item.name}".`),this._service.set("BACKOFFICE.removed",this.item.id),this._router.navigate(["/systems"]),this.modal_ref.close()},e=>{this.modal_ref.componentInstance.loading=null,this._service.notifyError(`Error deleting system. Error: ${JSON.stringify(e.response||e.message||e)}`)}))})),this.modal_ref.afterClosed().subscribe(()=>{this.unsub("modal_events"),this.modal_ref=null}))}}return e.\u0275fac=function(t){return new(t||e)(b.Rb(m.a),b.Rb(o.a),b.Rb(o.c),b.Rb(g.b))},e.\u0275cmp=b.Lb({type:e,selectors:[["app-systems"]],features:[b.Ab],decls:5,vars:27,consts:[[1,"container"],[1,"sidebar"],["heading","Systems",3,"module","close","event"],[3,"touchrelease"],["name","system","route","systems",3,"item","loading","tabs","event"]],template:function(e,t){1&e&&(b.Xb(0,"div",0),b.Xb(1,"div",1),b.Xb(2,"sidebar",2),b.mc("event",(function(e){return t.sidebarEvent(e)})),b.Wb(),b.Wb(),b.Xb(3,"main",3),b.mc("touchrelease",(function(){return t.show_sidebar=!1})),b.Xb(4,"item-display",4),b.mc("event",(function(e){return t.itemEvent(e)})),b.Wb(),b.Wb(),b.Wb()),2&e&&(b.Hb("show",t.show_sidebar),b.Db(2),b.wc("module",t.module)("close",t.show_sidebar),b.Db(2),b.wc("item",t.item)("loading",t.loading_item)("tabs",b.Bc(22,M,b.yc(8,_,b.xc(7,p)),b.zc(11,y,t.device_count,b.xc(10,v)),b.zc(15,O,t.zone_count,b.xc(14,w)),b.zc(19,C,t.trigger_count,b.xc(18,x)))))},directives:[h.a,u.b,f.a],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}@media only screen and (orientation:landscape) and (max-width:800px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;flex:1;background-color:#f0f0f0}@media only screen and (orientation:portrait) and (max-width:450px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}"]}),e})();var W,X,S,k,I,z,D,$,E,q,A=n("mrSG"),L=n("5f3J"),T=n("bTqV"),R=n("+BlP"),j=n("Xa2L"),F=n("oIn+");function H(e,t){if(1&e&&(b.Xb(0,"div",9),b.Xb(1,"label"),b.bc(2,k),b.Wb(),b.Xb(3,"div",10),b.Xb(4,"a",11),b.Rc(5),b.Wb(),b.Wb(),b.Wb()),2&e){const e=b.qc(2);b.Db(4),b.wc("href",e.item.support_url,b.Kc),b.Db(1),b.Sc(e.item.support_url)}}function N(e,t){if(1&e&&(b.Xb(0,"div",9),b.Xb(1,"label"),b.bc(2,I),b.Wb(),b.Xb(3,"div",10),b.Rc(4),b.Wb(),b.Wb()),2&e){const e=b.qc(2);b.Db(4),b.Sc(e.item.bookable?"Yes":"No")}}function B(e,t){if(1&e&&(b.Xb(0,"a",11),b.Rc(1),b.Wb()),2&e){const e=b.qc(3);b.wc("href","mailto:"+e.item.email,b.Kc),b.Db(1),b.Sc(e.item.email)}}function J(e,t){if(1&e&&(b.Xb(0,"div",9),b.Xb(1,"label"),b.bc(2,z),b.Wb(),b.Pc(3,B,2,2,"a",12),b.Wb()),2&e){const e=b.qc(2);b.Db(3),b.wc("ngIf",e.item.email)}}function Y(e,t){if(1&e&&(b.Xb(0,"div",9),b.Xb(1,"label"),b.bc(2,D),b.Wb(),b.Xb(3,"div",10),b.Rc(4),b.Wb(),b.Wb()),2&e){const e=b.qc(2);b.Db(4),b.Sc(e.item.capacity)}}function Z(e,t){if(1&e&&(b.Xb(0,"div",9),b.Xb(1,"label"),b.bc(2,$),b.Wb(),b.Xb(3,"div",10),b.Rc(4),b.Wb(),b.Wb()),2&e){const e=b.qc(2);b.Db(4),b.Sc(e.item.installed_ui_devices)}}function K(e,t){if(1&e&&(b.Xb(0,"div",9),b.Xb(1,"label"),b.bc(2,E),b.Wb(),b.Xb(3,"div",10),b.Rc(4),b.rc(5,"dateFrom"),b.Wb(),b.Wb()),2&e){const e=b.qc(2);b.Db(4),b.Sc(b.sc(5,1,1e3*e.item.created_at))}}function U(e,t){if(1&e&&(b.Xb(0,"div",9),b.Xb(1,"label"),b.bc(2,q),b.Wb(),b.Xb(3,"div",10),b.Rc(4),b.rc(5,"dateFrom"),b.Wb(),b.Wb()),2&e){const e=b.qc(2);b.Db(4),b.Sc(b.sc(5,1,1e3*e.item.updated_at))}}W=$localize`:@@systemStartAction␟6f81a8c7820d574bfb9547825d7fa432bfc66af1␟8154115013285965605:Start System`,X=$localize`:@@systemStopAction␟87a27185ae52b451c0f6d4127ce7fedf70ab1fb1␟5161697597209904801:Stop System`,S=$localize`:@@settingsLabel␟121cc5391cd2a5115bc2b3160379ee5b36cd7716␟4930506384627295710:Settings`,k=$localize`:@@systemUrlLabel␟7e26fea74dd85099364f23205324001d5f08d729␟206794270698958656:Support URL:`,I=$localize`:@@systemBookableLabel␟1729892dec33ddc3daf35f197b6882eb1c4a8a1b␟238801422848943760:Bookable Room:`,z=$localize`:@@emailLabel␟31703f614ddd8547d63317830a59c0a7b935778e␟8507709425849513695:Email: `,D=$localize`:@@capacityLabel␟a1170e85d1897210d5fe03d1f363587de15d02cd␟8062822823331512246:Capacity:`,$=$localize`:@@systemPanelCountLabel␟45b07d34ed29d3a5269b5bac86182781001845a9␟4375591254429334656:Installed Touch Panels:`,E=$localize`:@@systemCreatedAtLabel␟a5ed099ffc9e96f6970df843289ade8a7d20ab9f␟1616250945945379783:Created:`,q=$localize`:@systemUpdatedAtLabel␟f94240161f912dbd8758b858877cddeab80f36cb␟1116759395536210856:Updated:`;const V=function(){return[]};function G(e,t){if(1&e&&(b.Xb(0,"section"),b.Sb(1,"a-settings-form",13),b.Wb()),2&e){const e=b.qc(2);b.Db(1),b.wc("id",e.item.id)("merge",!0)("settings",e.item.settings)("merge_settings",e.other_settings||b.xc(4,V))}}function Q(e,t){if(1&e){const e=b.Yb();b.Xb(0,"div",2),b.Xb(1,"section",3),b.Xb(2,"button",4),b.mc("tapped",(function(){return b.Hc(e),b.qc().start()})),b.bc(3,W),b.Wb(),b.Xb(4,"button",4),b.mc("tapped",(function(){return b.Hc(e),b.qc().stop()})),b.bc(5,X),b.Wb(),b.Wb(),b.Xb(6,"section",5),b.Pc(7,H,6,2,"div",6),b.Pc(8,N,5,1,"div",6),b.Pc(9,J,4,1,"div",6),b.Pc(10,Y,5,1,"div",6),b.Pc(11,Z,5,1,"div",6),b.Pc(12,K,6,3,"div",6),b.Pc(13,U,6,3,"div",6),b.Wb(),b.Sb(14,"hr"),b.Xb(15,"header",7),b.bc(16,S),b.Wb(),b.Pc(17,G,2,5,"section",8),b.Wb()}if(2&e){const e=b.qc(),t=b.Ec(2);b.Db(7),b.wc("ngIf",e.item.support_url),b.Db(1),b.wc("ngIf",e.item.bookable),b.Db(1),b.wc("ngIf",e.item.bookable&&e.item.email),b.Db(1),b.wc("ngIf",e.item.capacity),b.Db(1),b.wc("ngIf",e.item.installed_ui_devices),b.Db(1),b.wc("ngIf",e.item.created_at),b.Db(1),b.wc("ngIf",e.item.updated_at),b.Db(4),b.wc("ngIf",!e.loading_settings)("ngIfElse",t)}}var ee;function te(e,t){1&e&&(b.Xb(0,"div",14),b.Xb(1,"div",15),b.Sb(2,"mat-spinner",16),b.Wb(),b.Xb(3,"div",17),b.bc(4,ee),b.Wb(),b.Wb())}ee=$localize`:@@systemLoadingLabel␟12761354f7c79edc553ff408524f5b791cd54481␟3385246531183416995:Loading system settings...`;let ne=(()=>{class e extends L.a{constructor(e,t){super(),this._service=e,this._dialog=t,this.other_settings=[]}modules(){return[...this.item.modules]}get loading_settings(){return this._service.get("loading_settings")}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe(e=>{this.item=e,this.loadZones(),this.loadSettings()}))}ngOnChanges(e){e.item&&this.item&&(this.loadZones(),this.loadSettings())}start(){const e=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Start system?",content:"Are you sure you want to start this system?<br>All stopped modules within the system will boot up.",icon:{type:"icon",class:"backoffice-controller-play"}}}));this.subscription("confirm_ref",e.componentInstance.event.subscribe(e=>{"done"===e.reason&&this._service.Systems.startSystem(this.item.id).then(e=>null,e=>this._service.notifyError(`Failed to start system: ${JSON.stringify(e.response||e.message||e)}`))}))}stop(){const e=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Stop system?",content:"Are you sure you want to stop this system?<br>All modules will be immediately stopped regardless of any other systems they may be in.",icon:{type:"icon",class:"backoffice-controller-stop"}}}));this.subscription("confirm_ref",e.componentInstance.event.subscribe(e=>{"done"===e.reason&&this._service.Systems.stopSystem(this.item.id).then(e=>null,e=>this._service.notifyError(`Failed to stop system: ${JSON.stringify(e.response||e.message||e)}`))}))}loadZones(){this.item&&this._service.Zones.query({control_system_id:this.item.id,offset:0}).then(e=>{e.sort((e,t)=>this.item.zones.indexOf(t.id)-this.item.zones.indexOf(e.id)),this.zones=e},()=>null)}loadSettings(){return Object(A.b)(this,void 0,void 0,(function*(){this.item&&(this.other_settings=yield this._service.Systems.settings(this.item.id))}))}}return e.\u0275fac=function(t){return new(t||e)(b.Rb(m.a),b.Rb(g.b))},e.\u0275cmp=b.Lb({type:e,selectors:[["system-about"]],inputs:{item:"item"},features:[b.Ab,b.Bb],decls:3,vars:1,consts:[["class","container",4,"ngIf"],["load_state",""],[1,"container"],[1,"select"],["mat-button","",3,"tapped"],[1,"details"],["class","field",4,"ngIf"],[1,"settings"],[4,"ngIf","ngIfElse"],[1,"field"],[1,"value"],["target","_blank",3,"href"],["target","_blank",3,"href",4,"ngIf"],[3,"id","merge","settings","merge_settings"],[1,"info-block"],[1,"icon"],["diameter","48"],[1,"text"]],template:function(e,t){1&e&&(b.Pc(0,Q,18,9,"div",0),b.Pc(1,te,5,0,"ng-template",null,1,b.Qc)),2&e&&b.wc("ngIf",t.item)},directives:[i.m,T.b,u.b,R.a,j.b],pipes:[F.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}header[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:700;font-size:1.1em;margin-bottom:.5em}header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.7em;color:rgba(0,0,0,.6);padding:0 1em;font-weight:300;text-decoration:underline;cursor:pointer;transition:color .2s}header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{color:rgba(0,0,0,.85)}header.settings[_ngcontent-%COMP%]{position:relative;top:.75em;margin:0}section[_ngcontent-%COMP%]{padding:.5em .25em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:.25em}button[_ngcontent-%COMP%]{margin:0 .25em}button[_ngcontent-%COMP%]:first-child{margin-left:0}button[_ngcontent-%COMP%]:last-child{margin-right:0}.field[_ngcontent-%COMP%]{display:flex;align-items:center;margin:.25em 0}.field[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{padding:0 .5em;-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all}label[_ngcontent-%COMP%]{font-size:.8em;font-weight:500}a[_ngcontent-%COMP%]{font-size:.9em}"]}),e})();var ie,se,oe,ce,ae,re,de,le,be=n("DuJs"),me=n("av/m"),ge=n("cqYI"),he=n("GrRB"),ue=n("Mj3r"),fe=n("EY9O"),pe=n("Qu3c"),_e=n("bSwM"),ve=n("STbY"),ye=n("0njA"),we=n("Cvi9");function Oe(e,t){if(1&e&&(b.Vb(0),b.Xb(1,"section",10),b.Xb(2,"h3"),b.bc(3,ce),b.Wb(),b.Sb(4,"system-exec-field",11),b.Wb(),b.Ub()),2&e){const e=b.qc(2);b.Db(4),b.wc("system",e.item)}}function xe(e,t){if(1&e){const e=b.Yb();b.Xb(0,"i",34),b.mc("modelChange",(function(t){return b.Hc(e),b.qc().$implicit.connected=t})),b.Wb()}if(2&e){const e=b.qc().$implicit,t=b.qc(3);b.wc("model",e.connected)("sys",t.item.id)("mod",t.device_classes[e.id])}}function Ce(e,t){1&e&&b.Sb(0,"i",35)}function Me(e,t){if(1&e){const e=b.Yb();b.Xb(0,"button",36),b.mc("tapped",(function(){b.Hc(e);const n=t.$implicit,i=b.qc().$implicit;return b.qc(3).handleContextEvent(n,i)})),b.Sb(1,"app-icon",30),b.Xb(2,"div",37),b.Rc(3),b.Wb(),b.Wb()}if(2&e){const e=t.$implicit;b.Db(1),b.wc("icon",e.icon),b.Db(2),b.Sc(e.name)}}function Pe(e,t){1&e&&b.Sb(0,"td",38)}ie=$localize`:@@addExistingAction␟e03814486fe2ec3ed315060ae27c4ccec0380c00␟4096041993839955424: Add existing `,se=$localize`:@@newAction␟52cb3a1dbc20365867f39819932e43d19542474d␟4948407374074297419:Add new`,oe=$localize`:@@moduleListHeader␟d6444eff6432d536c4d50ba42a33099ce5f7088b␟8179099976175023415:Module List`,ce=$localize`:@@execHeader␟35f05bbd8314aa4af70300d377f1c64c8128207c␟8077695877143433436:Execute command`,ae=$localize`:@@moduleStateLabel␟873b72903b1858a9cd6c8967521030b4d7d1435b␟5911214550882917183:State`,re=$localize`:@@moduleNameLabel␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,de=$localize`:@@moduleClassLabel␟f60c6c571ed1e6266976ca261a2b2d0ebaa16c6e␟4378796785985219718:Class`,le=$localize`:@@moduleIpLabel␟84738b1bbb866302445901b1bca1e9cb5bf8d006␟512712988274106243:IP`;const We=function(e){return["/modules",e]},Xe=function(){return{class:"backoffice-dots-three-vertical"}};function Se(e,t){if(1&e){const e=b.Yb();b.Xb(0,"tr",18),b.mc("contextAction",(function(n){b.Hc(e);const i=t.$implicit;return b.qc(3).handleContextEvent(n,i)})),b.Xb(1,"td",12),b.Xb(2,"div",19),b.Sb(3,"i",20),b.Wb(),b.Wb(),b.Xb(4,"td",12),b.Pc(5,xe,1,3,"i",21),b.Xb(6,"div",22),b.mc("tapped",(function(){b.Hc(e);const n=t.$implicit;return b.qc(3).power(n)})),b.Wb(),b.Wb(),b.Xb(7,"td",13),b.Xb(8,"a",23),b.mc("contextmenu",(function(t){return b.Hc(e),t.stopPropagation()})),b.Rc(9),b.Wb(),b.Wb(),b.Xb(10,"td",14),b.Xb(11,"mat-checkbox",24),b.mc("change",(function(){b.Hc(e);const n=t.$implicit;return b.qc(3).toggleDebugEvents(n)})),b.Rc(12),b.Wb(),b.Wb(),b.Xb(13,"td",15),b.Xb(14,"div",25),b.Pc(15,Ce,1,0,"i",26),b.Wb(),b.Xb(16,"a",27),b.Rc(17),b.Wb(),b.Wb(),b.Xb(18,"td",28),b.Xb(19,"button",29),b.Sb(20,"app-icon",30),b.Wb(),b.Xb(21,"mat-menu",null,31),b.Pc(23,Me,4,2,"button",32),b.Wb(),b.Wb(),b.Pc(24,Pe,1,0,"td",33),b.Wb()}if(2&e){const e=t.$implicit,n=b.Ec(22),i=b.qc(3);b.wc("context-menu",n)("offset_y",-64),b.Db(5),b.wc("ngIf",e&&i.item.id),b.Db(1),b.Hb("active",e.running&&"true"===e.connected)("inactive",e.running&&"false"===e.connected)("black",!e.running),b.Db(2),b.wc("routerLink",b.yc(20,We,e.id))("matTooltip",e.id),b.Db(1),b.Sc((null==e.driver?null:e.driver.name)||"<Unnamed>"),b.Db(2),b.wc("checked",i.debugged_modules[e.id]),b.Db(1),b.Tc(" ",i.device_classes[e.id]," "),b.Db(3),b.wc("ngIf",e.tls),b.Db(1),b.wc("href",(e.tls?"https://":"http://")+e.ip,b.Kc),b.Db(1),b.Sc(e.ip),b.Db(2),b.wc("matMenuTriggerFor",n),b.Db(1),b.wc("icon",b.xc(22,Xe)),b.Db(3),b.wc("ngForOf",e.running?i.menu_options:i.offline_options)}}const ke=function(){return[]};function Ie(e,t){if(1&e){const e=b.Yb();b.Xb(0,"table"),b.Xb(1,"thead"),b.Sb(2,"td",12),b.Xb(3,"td",12),b.bc(4,ae),b.Wb(),b.Xb(5,"td",13),b.bc(6,re),b.Wb(),b.Xb(7,"td",14),b.bc(8,de),b.Wb(),b.Xb(9,"td",15),b.bc(10,le),b.Wb(),b.Sb(11,"td",12),b.Wb(),b.Xb(12,"tbody",16),b.mc("cdkDropListDropped",(function(t){return b.Hc(e),b.qc(2).drop(t)})),b.Pc(13,Se,25,23,"tr",17),b.Wb(),b.Wb()}if(2&e){const e=b.qc(2);b.Db(13),b.wc("ngForOf",e.devices||b.xc(1,ke))}}var ze;function De(e,t){1&e&&(b.Xb(0,"div",39),b.Xb(1,"div",37),b.bc(2,ze),b.Wb(),b.Wb())}function $e(e,t){if(1&e){const e=b.Yb();b.Xb(0,"div",1),b.Xb(1,"section",2),b.Xb(2,"div",3),b.Xb(3,"item-search-field",4),b.mc("ngModelChange",(function(t){return b.Hc(e),b.qc().new_module=t.id})),b.Wb(),b.Wb(),b.Xb(4,"button",5),b.mc("tapped",(function(){return b.Hc(e),b.qc().addModule()})),b.bc(5,ie),b.Wb(),b.Xb(6,"button",6),b.mc("tapped",(function(){return b.Hc(e),b.qc().newModule()})),b.bc(7,se),b.Wb(),b.Wb(),b.Pc(8,Oe,5,1,"ng-container",7),b.Xb(9,"section",8),b.Xb(10,"h3"),b.bc(11,oe),b.Wb(),b.Pc(12,Ie,14,2,"table",7),b.Pc(13,De,3,0,"div",9),b.Wb(),b.Wb()}if(2&e){const e=b.qc();b.Db(3),b.wc("service",e.module_service)("exclude",e.exclude_fn)("ngModel",null),b.Db(1),b.wc("disabled",!e.new_module),b.Db(4),b.wc("ngIf",e.item.id&&e.item.modules&&!e.hide_exec),b.Db(4),b.wc("ngIf",e.devices&&e.devices.length>0),b.Db(1),b.wc("ngIf",!e.devices||e.devices.length<=0)}}ze=$localize`:@@moduleListEmpty␟9836797cbe920e8e21cad7119e531cf1a762f4f1␟3944265689033175665:No devices for system`;let Ee=(()=>{class e extends L.a{constructor(e,t,n){super(),this._service=e,this._dialog=t,this._debug_service=n,this.device_classes={},this.device_listener={},this.menu_options=[{id:"power",name:"Toggle Power",icon:{type:"icon",class:"backoffice-power-plug"}},{id:"state",name:"View State",icon:{type:"icon",class:"backoffice-eye"}},{id:"reload",name:"Recompile Driver",icon:{type:"icon",class:"backoffice-cw"}},{id:"remove",name:"Remove Module",icon:{type:"icon",class:"backoffice-trash"}},{id:"load",name:"Load Module",icon:{type:"icon",class:"backoffice-arrow-with-circle-up"}}],this.offline_options=[{id:"power",name:"Toggle Power",icon:{type:"icon",class:"backoffice-power-plug"}},{id:"remove",name:"Remove Module",icon:{type:"icon",class:"backoffice-trash"}},{id:"load",name:"Load Module",icon:{type:"icon",class:"backoffice-arrow-with-circle-up"}}],this.exclude_fn=e=>e.control_system_id===this.item.id||e.role===a.h.Logic}get module_service(){return this._service.Modules}get debugged_modules(){return this.devices.reduce((e,t)=>(e[t.id]=this._debug_service.isListening(t),e),{})}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe(e=>{this.item=e,this.loadModules()}))}ngOnChanges(e){e.item&&this.loadModules()}loadModules(e=0){this.item&&this._service.Modules.query({control_system_id:this.item.id,complete:!0,offset:e}).then(e=>{e.sort((e,t)=>this.item.modules.indexOf(e.id)-this.item.modules.indexOf(t.id)),this.devices=e,this.generateModuleBindings()},()=>null)}handleContextEvent(e,t){if(e)switch(e.id){case"power":this.power(t);break;case"state":this.viewState(t);break;case"reload":this.reloadModule(t);break;case"remove":this.remove(t);break;case"load":this.loadModule(t)}}power(e){this.hide_exec=!0,e.running?e.stop().then(()=>{this.hide_exec=!1,this._service.notifySuccess("Module successfully stopped"),e.running=!1},t=>{this.hide_exec=!1,"string"==typeof t&&t.length<64?this._service.notifyError(t):this._service.notifyError(`Failed to stop module '${e.id}'.\nView Error?`,"View",()=>this.viewDetails(t))}):e.start().then(()=>{this.hide_exec=!1,this._service.notifySuccess("Module successfully started"),e.running=!0},t=>{this.hide_exec=!1,"string"==typeof t&&t.length<64?this._service.notifyError(t):this._service.notifyError(`Failed to start module '${e.id}'.\nView Error?`,"View",()=>this.viewDetails(t))})}reload(e){this._service.Modules.show(e.id).then(t=>{for(const n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},()=>null)}viewState(e){this._dialog.open(be.a,{data:{system:this.item,module:e,devices:this.devices}})}reloadModule(e){const t=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Recompile module?",content:"New driver code will be loaded and the device settings will be reloaded.",icon:{type:"icon",class:"backoffice-install"}}}));this.subscription("confirm_ref",t.componentInstance.event.subscribe(n=>{"done"===n.reason&&((e.driver?e.driver.recompile():this._service.Drivers.recompile(e.driver_id)).then(e=>this._service.notifySuccess("Driver successfully recompiled."),e=>this._service.notifyError(JSON.stringify(e.response||e.message||e))),t.close(),this.unsub("confirm_ref"))}))}loadModule(e){this._service.Modules.load(e.id).then(()=>this._service.notifySuccess(`Successfully loaded module "${e.name||e.id}"`),e=>this._service.notifyError(`Error loading module. Error: ${JSON.stringify(e.response||e.message||e)}`))}viewDetails(e){this._dialog.open(me.a,{data:{content:e}})}drop(e){if(e&&e.previousIndex!==e.currentIndex){const t=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Change order?",content:"Are you sure you want to change the module priority?<br>Settings will be updated immediately for the system.",icon:{type:"icon",class:"backoffice-layers"}}}));this.subscription("confirm_ref",t.componentInstance.event.subscribe(n=>{if("done"===n.reason){this.hide_exec=!0,t.componentInstance.loading="Updating module order...";const n=[...this.item.modules];Object(c.f)(n,e.previousIndex,e.currentIndex),this.item.storePendingChange("modules",n),this.item.save().then(()=>{this.hide_exec=!1,t.close(),this.unsub("confirm_ref")},e=>{this.hide_exec=!1,t.componentInstance.loading=null,this._service.notifyError(`Error reording modules. Error: ${JSON.stringify(e.response||e.message||e)}`)})}}))}}remove(e){const t=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Remove module?",content:`Remove ${e.driver_id} from this system?<br>If this is not used elsewhere the associated data will be removed immediately.`,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("confirm_ref",t.componentInstance.event.subscribe(n=>{"done"===n.reason&&(this.hide_exec=!0,this.item.removeModule(e.id).then(()=>{this.hide_exec=!1,this._service.notifySuccess("Succefully removed module."),this.devices.splice(this.devices.indexOf(e),1),t.close(),this.unsub("confirm_ref")},e=>{this.hide_exec=!1,this._service.notifyError(`Error removing module. Error: ${JSON.stringify(e.response||e.message||e)}`),t.close(),this.unsub("confirm_ref")}))}))}newModule(){const e=this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new a.j({control_system_id:this.item.id,control_system:this.item}),service:this._service.Modules,readonly:!0}});this.subscription("modal_events",e.componentInstance.event.subscribe(e=>{"done"===e.reason&&(this.hide_exec=!0,this._service.Systems.addModule(this.item.id,e.metadata.item.id).then(()=>{this.hide_exec=!1,this.item=new a.p(Object.assign(Object.assign({},this.item),{modules:this.item.modules.concat(e.metadata.item.id),version:this.item._version++})),this._service.set("BACKOFFICE.active_item",this.item),this.timeout("reload_module_list",()=>this.loadModules(),1e3)},e=>{this.hide_exec=!1}))})),e.afterClosed().subscribe(()=>{this.unsub("modal_events")})}addModule(){this.new_module&&(this.joinModule(this.new_module),this.new_module="")}joinModule(e){const t=[...this.item.modules];t.indexOf(e)<0&&t.push(e),this.hide_exec=!0,this.item.storePendingChange("modules",t),this._service.Systems.addModule(this.item.id,e).then(()=>{this.hide_exec=!1,this.item=new a.p(Object.assign(Object.assign({},this.item),{modules:this.item.modules.concat(e),version:this.item._version++})),this._service.notifySuccess("Successfully added device to system"),this.loadModules()},()=>{this.hide_exec=!1,this._service.notifyError("Failed to add module to system")})}toggleDebugEvents(e){e&&(this._debug_service.isListening(e)?this._debug_service.unbind(e):this._debug_service.bind(e,this.device_classes[e.id]))}generateModuleBindings(){const e={};for(const t of this.devices){const n=t.custom_name||t.name||"Blank";e[n]||(e[n]=0),this.device_classes[t.id]=`${n}_${++e[n]}`}}}return e.\u0275fac=function(t){return new(t||e)(b.Rb(m.a),b.Rb(g.b),b.Rb(ge.a))},e.\u0275cmp=b.Lb({type:e,selectors:[["system-modules"]],inputs:{item:"item"},features:[b.Ab,b.Bb],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"select"],[1,"dropdown"],[3,"service","exclude","ngModel","ngModelChange"],["mat-button","",3,"disabled","tapped"],["mat-button","",3,"tapped"],[4,"ngIf"],[1,"device-list"],["class","info-block",4,"ngIf"],[1,"exec"],[3,"system"],[1,"small"],[1,"name"],[1,"module"],[1,"ip"],["cdkDropList","",3,"cdkDropListDropped"],["cdkDrag","",3,"context-menu","offset_y","contextAction",4,"ngFor","ngForOf"],["cdkDrag","",3,"context-menu","offset_y","contextAction"],["cdkDragHandle","",1,"action","grab"],[1,"backoffice-select-arrows"],["binding","","bind","connected",3,"model","sys","mod","modelChange",4,"ngIf"],[1,"state",3,"tapped"],["routerLinkActive","router-link-active",3,"routerLink","matTooltip","contextmenu"],[3,"checked","change"],[1,"lock"],["class","backoffice-lock",4,"ngIf"],[3,"href"],["touchrelease","",1,"small"],["mat-icon-button","",3,"matMenuTriggerFor"],[3,"icon"],["menu","matMenu"],["mat-menu-item","",3,"tapped",4,"ngFor","ngForOf"],["class","placeholder","colspan","6",4,"cdkDragPlaceholder"],["binding","","bind","connected",3,"model","sys","mod","modelChange"],[1,"backoffice-lock"],["mat-menu-item","",3,"tapped"],[1,"text"],["colspan","6",1,"placeholder"],[1,"info-block"]],template:function(e,t){1&e&&b.Pc(0,$e,14,7,"div",0),2&e&&b.wc("ngIf",t.item)},directives:[i.m,he.a,s.l,s.o,T.b,u.b,ue.a,c.d,i.l,c.a,fe.a,c.b,o.f,o.e,pe.a,_e.a,ve.c,ye.a,ve.d,c.c,we.a,ve.a],styles:[".container[_ngcontent-%COMP%]{position:absolute;display:flex;flex-direction:column;top:4em;left:0;right:0;bottom:0;overflow:hidden}.options[_ngcontent-%COMP%]{display:flex;font-size:1.2em;max-width:5em;margin:0}.dropdown[_ngcontent-%COMP%]{flex:1;height:3.25em}mat-form-field[_ngcontent-%COMP%]{flex:1}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1;width:5em}.table-row[_ngcontent-%COMP%]   .module[_ngcontent-%COMP%]{width:10em;min-width:7em}.placeholder[_ngcontent-%COMP%]{background:#ccc;border:3px dotted #999;min-height:3em;transition:transform .25s cubic-bezier(0,0,.2,1)}.device-list[_ngcontent-%COMP%]{flex:1;min-height:8em;overflow:auto;padding:0 1em}h3[_ngcontent-%COMP%]{margin:.5em 0}.exec[_ngcontent-%COMP%]{padding:0 1em}.lock[_ngcontent-%COMP%]{height:1.2em;width:1.2em;display:inline-flex;align-items:center;justify-content:center}.state[_ngcontent-%COMP%]{height:16px;width:16px;margin:.25em;background-color:#000;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.inactive[_ngcontent-%COMP%]{background-color:#f44336}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:8px;width:8px;margin:8px}.state.black[_ngcontent-%COMP%]{background-color:#000}.terminal[_ngcontent-%COMP%]{padding-top:.5em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:.5em 1em 0}@media only screen and (orientation:portrait) and (max-width:450px){.select[_ngcontent-%COMP%]{flex-wrap:wrap}}@media only screen and (orientation:landscape) and (max-width:800px){.select[_ngcontent-%COMP%]{flex-wrap:wrap}}@media only screen and (orientation:portrait) and (max-width:450px){.select[_ngcontent-%COMP%]   .dropdown[_ngcontent-%COMP%]{min-width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.select[_ngcontent-%COMP%]   .dropdown[_ngcontent-%COMP%]{min-width:100%}}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .25em}@media only screen and (orientation:portrait) and (max-width:450px){.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:.25em;flex:1}}@media only screen and (orientation:landscape) and (max-width:800px){.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:.25em;flex:1}}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}@media only screen and (orientation:portrait) and (max-width:450px){.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){margin-left:0}}@media only screen and (orientation:landscape) and (max-width:800px){.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){margin-left:0}}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{margin-right:0}.grab[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.placeholder[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.1);border:4px dashed rgba(0,0,0,.6);height:2em}.mat-menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:0 1em}.mat-menu-item[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.2em}.mat-menu-item[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{flex:1;min-width:50%;margin-left:.5em}"]}),e})();var qe,Ae,Le,Te,Re=n("uxQG"),je=n("kmnG"),Fe=n("qFsG");qe=$localize`:@@addTriggerAction␟c1c4a42ba190fc42b9672315d2dcc668340fa97a␟8173039025352077970:Add trigger`,Ae=$localize`:@@triggerTableName␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,Le=$localize`:@@triggerTableCount␟06412bce0f4fe4311193e9763666089bf9d980da␟8177873832400820695:Count`,Te=$localize`:@@triggerTableAddedTime␟80e3b490720757978c99a7b5af3885faf202b955␟231679111972850796:Added`;const He=function(e){return["/triggers",e]},Ne=function(){return{class:"backoffice-edit"}},Be=function(){return{class:"backoffice-trash"}};function Je(e,t){if(1&e){const e=b.Yb();b.Xb(0,"tr"),b.Xb(1,"td",13),b.Sb(2,"div",19),b.Wb(),b.Xb(3,"td",14),b.Xb(4,"a",20),b.Rc(5),b.Wb(),b.Wb(),b.Xb(6,"td",15),b.Rc(7),b.Wb(),b.Xb(8,"td",16),b.Rc(9),b.rc(10,"dateFrom"),b.Wb(),b.Xb(11,"td",17),b.Xb(12,"div",21),b.Xb(13,"button",22),b.mc("tapped",(function(){b.Hc(e);const n=t.$implicit;return b.qc(3).editTrigger(n)})),b.Sb(14,"app-icon",9),b.Wb(),b.Xb(15,"button",22),b.mc("tapped",(function(){b.Hc(e);const n=t.$implicit;return b.qc(3).deleteTrigger(n)})),b.Sb(16,"app-icon",9),b.Wb(),b.Wb(),b.Wb(),b.Wb()}if(2&e){const e=t.$implicit;b.Db(2),b.Hb("active",e.enabled),b.Db(2),b.wc("routerLink",b.yc(11,He,e.id))("matTooltip",e.id),b.Db(1),b.Sc(e.name),b.Db(2),b.Sc(e.activated_count||"0"),b.Db(2),b.Sc(b.sc(10,9,1e3*(e.created_at-0))),b.Db(5),b.wc("icon",b.xc(13,Ne)),b.Db(2),b.wc("icon",b.xc(14,Be))}}function Ye(e,t){if(1&e&&(b.Xb(0,"table"),b.Xb(1,"thead"),b.Sb(2,"td",13),b.Xb(3,"td",14),b.bc(4,Ae),b.Wb(),b.Xb(5,"td",15),b.bc(6,Le),b.Wb(),b.Xb(7,"td",16),b.bc(8,Te),b.Wb(),b.Sb(9,"td",17),b.Wb(),b.Xb(10,"tbody"),b.Pc(11,Je,17,15,"tr",18),b.Wb(),b.Wb()),2&e){const e=b.qc(2);b.Db(11),b.wc("ngForOf",e.trigger_list)}}const Ze=function(){return{class:"backoffice-magnifying-glass"}};function Ke(e,t){if(1&e){const e=b.Yb();b.Xb(0,"div",2),b.Xb(1,"div",3),b.Xb(2,"section",4),b.Xb(3,"div",5),b.Xb(4,"button",6),b.mc("tapped",(function(){return b.Hc(e),b.qc().selectTriggerToAdd()})),b.bc(5,qe),b.Wb(),b.Wb(),b.Xb(6,"mat-form-field",7),b.Xb(7,"div",8),b.Sb(8,"app-icon",9),b.Wb(),b.Xb(9,"input",10),b.mc("ngModelChange",(function(t){return b.Hc(e),b.qc().search_str=t})),b.Wb(),b.Wb(),b.Wb(),b.Xb(10,"section",11),b.Pc(11,Ye,12,1,"table",12),b.Wb(),b.Wb(),b.Wb()}if(2&e){const e=b.qc(),t=b.Ec(2);b.Db(8),b.wc("icon",b.xc(4,Ze)),b.Db(1),b.wc("ngModel",e.search_str),b.Db(2),b.wc("ngIf",e.trigger_list.length>0)("ngIfElse",t)}}var Ue;function Ve(e,t){1&e&&(b.Xb(0,"div",23),b.Xb(1,"div",24),b.bc(2,Ue),b.Wb(),b.Wb())}Ue=$localize`:@@triggerTableEmpty␟177b8a965eb2275e1b71e2704477af95207b40f2␟1550481348661348485:No triggers for system`;let Ge=(()=>{class e extends L.a{constructor(e,t,n){super(),this._service=e,this._dialog=t,this._composer=n,this.trigger_list=[]}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe(e=>{this.item=e,this.loadSystemTriggers()}))}ngOnChanges(e){e.item&&this.loadSystemTriggers()}loadSystemTriggers(e=0){this.item&&this._service.Systems.listTriggers(this.item.id).then(e=>{this.trigger_list=e},()=>null)}editTrigger(e){if(this.item&&e){const t=this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:e,service:this._service.Triggers,external_save:!0}});this.subscription("delete_confirm",t.componentInstance.event.subscribe(n=>{"action"===n.reason&&(t.componentInstance.loading="Saving trigger settings...",this._composer.http.put(`${this._composer.auth.api_endpoint}/systems/${this.item.id}/triggers/${e.id}`,e.toJSON(!0)).subscribe(()=>null,e=>{t.componentInstance.loading=null,this._service.notifyError(`Error updating trigger settings. Error: ${JSON.stringify(e.response||e.message||e)}`)},()=>{this._service.notifySuccess("Successfully updated trigger settings."),t.close(),this.unsub("delete_confirm")}))}))}}deleteTrigger(e){if(this.item&&e){const t=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Remove trigger",content:`<p>Are you sure you want remove trigger "${e.name}"?</p><p>Configuration will be updated <strong>immediately</strong>.</p>`,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",t.componentInstance.event.subscribe(n=>{"done"===n.reason&&(t.componentInstance.loading="Removing trigger...",this._composer.http.delete(`${this._composer.auth.api_endpoint}/systems/${this.item.id}/triggers/${e.id}`).subscribe(()=>null,e=>{t.componentInstance.loading=null,this._service.notifyError(`Error removing trigger. Error: ${JSON.stringify(e.response||e.message||e)}`)},()=>{this._service.notifySuccess(`Successfully deleted trigger "${this.item.name}".`),t.close(),this.unsub("delete_confirm")}))}))}}selectTriggerToAdd(){const e=this._dialog.open(Re.a,{height:"auto",width:"auto",data:{service_name:"Triggers"}});this.subscription("dialog_events",e.componentInstance.event.subscribe(t=>{const n=e.componentInstance.item;"action"===t.reason&&n&&(this.addTrigger(n),e.close())})),e.afterClosed().subscribe(()=>this.unsub("dialog_events"))}addTrigger(e){this._service.Systems.addTrigger(this.item.id,{control_system_id:this.item.id,enabled:!0,important:!1,trigger_id:e.id})}}return e.\u0275fac=function(t){return new(t||e)(b.Rb(m.a),b.Rb(g.b),b.Rb(we.c))},e.\u0275cmp=b.Lb({type:e,selectors:[["system-triggers"]],inputs:{item:"item"},features:[b.Ab,b.Bb],decls:3,vars:1,consts:[["class","container",4,"ngIf"],["empty_state",""],[1,"container"],[1,"settings"],[1,"select"],[1,"dropdown"],["mat-button","",3,"tapped"],["appearance","outline"],["matPrefix","",1,"prefix"],[3,"icon"],["matInput","","name","search-filter","placeholder","Filter Triggers",3,"ngModel","ngModelChange"],[1,"list"],[4,"ngIf","ngIfElse"],[1,"small"],[1,"flex"],[1,"count"],[1,"added"],[1,"duo"],[4,"ngFor","ngForOf"],[1,"state"],[3,"routerLink","matTooltip"],[1,"actions"],["mat-icon-button","",3,"tapped"],[1,"info-block"],[1,"text"]],template:function(e,t){1&e&&(b.Pc(0,Ke,12,5,"div",0),b.Pc(1,Ve,3,0,"ng-template",null,1,b.Qc)),2&e&&b.wc("ngIf",t.item)},directives:[i.m,T.b,u.b,je.c,je.f,ye.a,Fe.a,s.b,s.l,s.o,i.l,o.f,pe.a],pipes:[F.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.list[_ngcontent-%COMP%]{margin-top:.5em}.table-row[_ngcontent-%COMP%]   .added[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{width:8em;min-width:8em}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.state[_ngcontent-%COMP%]{height:16px;width:16px;margin:.25em;background-color:#d32f2f;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:8px;width:8px;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center}.select[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1;min-width:50%}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .25em 1.5em}.select[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.25em}.duo[_ngcontent-%COMP%]{width:6em}.actions[_ngcontent-%COMP%]{display:flex}"]}),e})();var Qe,et,tt=n("YxBP");function nt(e,t){1&e&&b.Sb(0,"td",9)}function it(e,t){if(1&e){const e=b.Yb();b.Xb(0,"td",9),b.Xb(1,"button",20),b.mc("tapped",(function(){b.Hc(e);const t=b.qc().$implicit;return b.qc(3).removeZone(t)})),b.Sb(2,"i",21),b.Wb(),b.Wb()}}function st(e,t){1&e&&b.Sb(0,"td",22)}Qe=$localize`:@@zoneTableEmpty␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,et=$localize`:@@descriptionLabel␟eec715de352a6b114713b30b640d319fa78207a0␟4902817035128594900:Description`;const ot=function(e){return["/zones",e]};function ct(e,t){if(1&e&&(b.Xb(0,"tr",15),b.Xb(1,"td",9),b.Xb(2,"div",16),b.Sb(3,"i",17),b.Wb(),b.Wb(),b.Xb(4,"td",10),b.Xb(5,"a",18),b.Rc(6),b.Wb(),b.Wb(),b.Xb(7,"td",11),b.Rc(8),b.Wb(),b.Pc(9,it,3,0,"td",12),b.Pc(10,st,1,0,"td",19),b.Wb()),2&e){const e=t.$implicit,n=b.qc(3);b.Db(5),b.wc("routerLink",b.yc(5,ot,e.id))("matTooltip",e.id),b.Db(1),b.Sc(e.name),b.Db(2),b.Sc(e.description),b.Db(1),b.wc("ngIf",n.zones.length>1)}}function at(e,t){if(1&e){const e=b.Yb();b.Xb(0,"table"),b.Xb(1,"thead"),b.Sb(2,"td",9),b.Xb(3,"td",10),b.bc(4,Qe),b.Wb(),b.Xb(5,"td",11),b.bc(6,et),b.Wb(),b.Pc(7,nt,1,0,"td",12),b.Wb(),b.Xb(8,"tbody",13),b.mc("cdkDropListDropped",(function(t){return b.Hc(e),b.qc(2).drop(t)})),b.Pc(9,ct,11,7,"tr",14),b.Wb(),b.Wb()}if(2&e){const e=b.qc(2);b.Db(7),b.wc("ngIf",e.zones.length>1),b.Db(2),b.wc("ngForOf",e.zones)}}var rt;function dt(e,t){1&e&&(b.Xb(0,"div",23),b.Xb(1,"div",24),b.bc(2,rt),b.Wb(),b.Wb())}function lt(e,t){if(1&e){const e=b.Yb();b.Xb(0,"div",1),b.Xb(1,"div",2),b.Xb(2,"section",3),b.Xb(3,"div",4),b.Xb(4,"item-search-field",5),b.mc("ngModelChange",(function(t){return b.Hc(e),b.qc().new_zone=t})),b.Wb(),b.Wb(),b.Xb(5,"button",6),b.mc("tapped",(function(){return b.Hc(e),b.qc().joinZone()})),b.Rc(6,"Join zone"),b.Wb(),b.Wb(),b.Xb(7,"section"),b.Pc(8,at,10,2,"table",7),b.Pc(9,dt,3,0,"div",8),b.Wb(),b.Wb(),b.Wb()}if(2&e){const e=b.qc();b.Db(4),b.wc("service",e.zone_service)("exclude",e.exclude_fn)("ngModel",null),b.Db(1),b.wc("disabled",!e.new_zone),b.Db(3),b.wc("ngIf",e.zones&&e.zones.length>0),b.Db(1),b.wc("ngIf",!e.zones||e.zones.length<=0)}}rt=$localize`:@@zoneTableEmpty␟5ba52f7f708dd84732d74bb76b8643df29370f16␟3859183549731946351:No zones for system`;const bt=[{path:":id",component:P,children:[{path:"about",component:ne},{path:"modules",component:Ee},{path:"triggers",component:Ge},{path:"zones",component:(()=>{class e extends L.a{constructor(e,t){super(),this._service=e,this._dialog=t,this.loading=new b.o,this.exclude_fn=e=>this.item.zones.indexOf(e.id)>=0}get zone_service(){return this._service.Zones}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe(e=>{this.item=e,this.loadZones()}))}ngOnChanges(e){e.item&&this.loadZones()}loadZones(e=0){this.item&&this._service.Systems.listZones(this.item.id).then(e=>{e.sort((e,t)=>this.item.zones.indexOf(e.id)-this.item.zones.indexOf(t.id)),this.zones=e},()=>null)}drop(e){if(e&&e.previousIndex!==e.currentIndex){const t=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Change order?",content:"Are you sure you want to change the zone priority?<br>Settings will be updated immediately for the system.",icon:{type:"icon",class:"backoffice-cycle"}}}));this.subscription("confirm_ref",t.componentInstance.event.subscribe(n=>{if("done"===n.reason){const n=[...this.item.zones];Object(c.f)(n,e.previousIndex,e.currentIndex),t.componentInstance.loading="Updating zone ordering...",this.item.storePendingChange("zones",n),this.item.save().then(()=>{t.close(),this.unsub("confirm_ref")},e=>{t.componentInstance.loading=null,this._service.notifyError(`Error reording zones. Error: ${JSON.stringify(e.response||e.message||e)}`)})}}))}}removeZone(e){if(e&&e.id){const t=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Remove zone?",content:`<p>Are you sure you want remove zone "${e.name}" from the system?</p>Configuration will be updated immediately.`,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("confirm_ref",t.componentInstance.event.subscribe(n=>{"done"===n.reason&&(this.loading.emit(!0),this.item.storePendingChange("zones",this.item.zones.filter(t=>t!==e.id)),this.item.save().then(n=>{this.loading.emit(!1),this.item=n,this._service.notifySuccess(`Remove zone "${e.name}" from system`),t.close(),this.unsub("confirm_ref")},n=>{this.loading.emit(!1),this._service.notifySuccess(`Error removing "${e.name}" from system. Error: ${JSON.stringify(n.response||n.message||n)}`),t.close(),this.unsub("confirm_ref")}))}))}}joinZone(){if(this.new_zone)if(this.item.zones.indexOf(this.new_zone.id)<0){this.loading.emit(!0);const e=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Add zone",content:`Add zone "${this.new_zone.name}" to system "${this.item.name}"`,icon:{type:"icon",class:"backoffice-upload-to-cloud"}}}));this.subscription("confirm_ref",e.componentInstance.event.subscribe(t=>{"done"===t.reason?(e.componentInstance.loading="Adding zone to system...",this.item.storePendingChange("zones",Object(tt.i)([...this.item.zones,this.new_zone.id])),this.item.save().then(t=>{this.loading.emit(!1),this._service.notifySuccess(`Added zone "${this.new_zone.name}" to system`),this.item=t,this.loadZones(),e.close(),this.unsub("confirm_ref"),this.new_zone=null},t=>{e.componentInstance.loading=null,this.loading.emit(!1),this._service.notifyError(`Error adding zone "${this.new_zone.name}". Error: ${JSON.stringify(t.response||t.message||t)}`)})):this.loading.emit(!1)}))}else this._service.notifyInfo("The selected zone is already linked to this system")}}return e.\u0275fac=function(t){return new(t||e)(b.Rb(m.a),b.Rb(g.b))},e.\u0275cmp=b.Lb({type:e,selectors:[["system-zones"]],inputs:{item:"item"},outputs:{loading:"loading"},features:[b.Ab,b.Bb],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"settings"],[1,"select"],[1,"dropdown"],[3,"service","exclude","ngModel","ngModelChange"],["mat-button","",3,"disabled","tapped"],[4,"ngIf"],["class","info-block",4,"ngIf"],[1,"small"],[1,"name"],[1,"description"],["class","small",4,"ngIf"],["cdkDropList","",3,"cdkDropListDropped"],["cdkDrag","",4,"ngFor","ngForOf"],["cdkDrag",""],["cdkDragHandle","",1,"action","grab"],[1,"backoffice-select-arrows"],["routerLinkActive","router-link-active",3,"routerLink","matTooltip"],["class","placeholder","colspan","6",4,"cdkDragPlaceholder"],["mat-icon-button","",3,"tapped"],[1,"backoffice-trash"],["colspan","6",1,"placeholder"],[1,"info-block"],[1,"text"]],template:function(e,t){1&e&&b.Pc(0,lt,10,6,"div",0),2&e&&b.wc("ngIf",t.item)},directives:[i.m,he.a,s.l,s.o,T.b,u.b,c.d,i.l,c.a,c.b,o.f,o.e,pe.a,c.c],styles:[".container[_ngcontent-%COMP%]{padding:1em}header[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em}section[_ngcontent-%COMP%]{padding:.5em .25em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .25em 1.5em}.dropdown[_ngcontent-%COMP%]{flex:1}.placeholder[_ngcontent-%COMP%]{background:#ccc;border:3px dotted #999;min-height:3em;height:3em;transition:transform .25s cubic-bezier(0,0,.2,1)}.name[_ngcontent-%COMP%]{min-width:10em}.description[_ngcontent-%COMP%]{font-size:.8em;padding:.5em}"]}),e})()},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}];var mt=n("PCNd");n.d(t,"AppSystemsModule",(function(){return gt}));let gt=(()=>{class e{}return e.\u0275mod=b.Pb({type:e}),e.\u0275inj=b.Ob({factory:function(t){return new(t||e)},imports:[[i.c,s.g,o.g.forChild(bt),mt.a,c.e]]}),e})()}}]);