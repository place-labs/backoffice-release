function _templateObject28(){var e=_taggedTemplateLiteral([":@@zoneTableEmpty\u241f5ba52f7f708dd84732d74bb76b8643df29370f16\u241f3859183549731946351:No zones for system"]);return _templateObject28=function(){return e},e}function _templateObject27(){var e=_taggedTemplateLiteral([":@@descriptionLabel\u241feec715de352a6b114713b30b640d319fa78207a0\u241f4902817035128594900:Description"]);return _templateObject27=function(){return e},e}function _templateObject26(){var e=_taggedTemplateLiteral([":@@zoneTableEmpty\u241fcff1428d10d59d14e45edec3c735a27b5482db59\u241f8953033926734869941:Name"]);return _templateObject26=function(){return e},e}function _templateObject25(){var e=_taggedTemplateLiteral([":@@triggerTableEmpty\u241f177b8a965eb2275e1b71e2704477af95207b40f2\u241f1550481348661348485:No triggers for system"]);return _templateObject25=function(){return e},e}function _templateObject24(){var e=_taggedTemplateLiteral([":@@triggerTableAddedTime\u241f80e3b490720757978c99a7b5af3885faf202b955\u241f231679111972850796:Added"]);return _templateObject24=function(){return e},e}function _templateObject23(){var e=_taggedTemplateLiteral([":@@triggerTableCount\u241f06412bce0f4fe4311193e9763666089bf9d980da\u241f8177873832400820695:Count"]);return _templateObject23=function(){return e},e}function _templateObject22(){var e=_taggedTemplateLiteral([":@@triggerTableName\u241fcff1428d10d59d14e45edec3c735a27b5482db59\u241f8953033926734869941:Name"]);return _templateObject22=function(){return e},e}function _templateObject21(){var e=_taggedTemplateLiteral([":@@addTriggerAction\u241fc1c4a42ba190fc42b9672315d2dcc668340fa97a\u241f8173039025352077970:Add trigger"]);return _templateObject21=function(){return e},e}function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,r=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return r=e.done,e},e:function(e){a=!0,c=e},f:function(){try{r||null==n.return||n.return()}finally{if(a)throw c}}}}function _templateObject20(){var e=_taggedTemplateLiteral([":@@moduleListEmpty\u241f9836797cbe920e8e21cad7119e531cf1a762f4f1\u241f3944265689033175665:No devices for system"]);return _templateObject20=function(){return e},e}function _templateObject19(){var e=_taggedTemplateLiteral([":@@moduleIpLabel\u241f84738b1bbb866302445901b1bca1e9cb5bf8d006\u241f512712988274106243:IP"]);return _templateObject19=function(){return e},e}function _templateObject18(){var e=_taggedTemplateLiteral([":@@moduleClassLabel\u241ff60c6c571ed1e6266976ca261a2b2d0ebaa16c6e\u241f4378796785985219718:Class"]);return _templateObject18=function(){return e},e}function _templateObject17(){var e=_taggedTemplateLiteral([":@@moduleNameLabel\u241fcff1428d10d59d14e45edec3c735a27b5482db59\u241f8953033926734869941:Name"]);return _templateObject17=function(){return e},e}function _templateObject16(){var e=_taggedTemplateLiteral([":@@moduleStateLabel\u241f873b72903b1858a9cd6c8967521030b4d7d1435b\u241f5911214550882917183:State"]);return _templateObject16=function(){return e},e}function _templateObject15(){var e=_taggedTemplateLiteral([":@@execHeader\u241f35f05bbd8314aa4af70300d377f1c64c8128207c\u241f8077695877143433436:Execute command"]);return _templateObject15=function(){return e},e}function _templateObject14(){var e=_taggedTemplateLiteral([":@@moduleListHeader\u241fd6444eff6432d536c4d50ba42a33099ce5f7088b\u241f8179099976175023415:Module List"]);return _templateObject14=function(){return e},e}function _templateObject13(){var e=_taggedTemplateLiteral([":@@newAction\u241f52cb3a1dbc20365867f39819932e43d19542474d\u241f4948407374074297419:Add new"]);return _templateObject13=function(){return e},e}function _templateObject12(){var e=_taggedTemplateLiteral([":@@addExistingAction\u241fe03814486fe2ec3ed315060ae27c4ccec0380c00\u241f4096041993839955424: Add existing "]);return _templateObject12=function(){return e},e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _templateObject11(){var e=_taggedTemplateLiteral([":@@systemLoadingLabel\u241f12761354f7c79edc553ff408524f5b791cd54481\u241f3385246531183416995:Loading system settings..."]);return _templateObject11=function(){return e},e}function _templateObject10(){var e=_taggedTemplateLiteral([":@systemUpdatedAtLabel\u241ff94240161f912dbd8758b858877cddeab80f36cb\u241f1116759395536210856:Updated:"]);return _templateObject10=function(){return e},e}function _templateObject9(){var e=_taggedTemplateLiteral([":@@systemCreatedAtLabel\u241fa5ed099ffc9e96f6970df843289ade8a7d20ab9f\u241f1616250945945379783:Created:"]);return _templateObject9=function(){return e},e}function _templateObject8(){var e=_taggedTemplateLiteral([":@@systemPanelCountLabel\u241f45b07d34ed29d3a5269b5bac86182781001845a9\u241f4375591254429334656:Installed Touch Panels:"]);return _templateObject8=function(){return e},e}function _templateObject7(){var e=_taggedTemplateLiteral([":@@capacityLabel\u241fa1170e85d1897210d5fe03d1f363587de15d02cd\u241f8062822823331512246:Capacity:"]);return _templateObject7=function(){return e},e}function _templateObject6(){var e=_taggedTemplateLiteral([":@@emailLabel\u241f31703f614ddd8547d63317830a59c0a7b935778e\u241f8507709425849513695:Email:\xa0"]);return _templateObject6=function(){return e},e}function _templateObject5(){var e=_taggedTemplateLiteral([":@@systemBookableLabel\u241f1729892dec33ddc3daf35f197b6882eb1c4a8a1b\u241f238801422848943760:Bookable Room:"]);return _templateObject5=function(){return e},e}function _templateObject4(){var e=_taggedTemplateLiteral([":@@systemUrlLabel\u241f7e26fea74dd85099364f23205324001d5f08d729\u241f206794270698958656:Support URL:"]);return _templateObject4=function(){return e},e}function _templateObject3(){var e=_taggedTemplateLiteral([":@@settingsLabel\u241f121cc5391cd2a5115bc2b3160379ee5b36cd7716\u241f4930506384627295710:Settings"]);return _templateObject3=function(){return e},e}function _templateObject2(){var e=_taggedTemplateLiteral([":@@systemStopAction\u241f87a27185ae52b451c0f6d4127ce7fedf70ab1fb1\u241f5161697597209904801:Stop System"]);return _templateObject2=function(){return e},e}function _templateObject(){var e=_taggedTemplateLiteral([":@@systemStartAction\u241f6f81a8c7820d574bfb9547825d7fa432bfc66af1\u241f8154115013285965605:Start System"]);return _templateObject=function(){return e},e}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=_superPropBase(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{nSQh:function(e,t,n){"use strict";n.r(t);var i,o,c,r,a,s,l,d,u,b,m,f=n("ofXK"),g=n("3Pt+"),p=n("tyNb"),_=n("5+WD"),h=n("THE0"),v=n("C/ya"),y=n("D/9M"),O=n("g+Po"),w=n("fXoL"),C=n("OaWH"),P=n("0IaG"),x=n("BAfr"),M=n("m6yr"),k=n("47y3"),j=function(){return{class:"backoffice-info-with-circle"}},S=function(e){return{id:"about",name:"About",icon:e}},W=function(){return{class:"backoffice-tablet"}},X=function(e,t){return{id:"modules",name:"Modules",count:e,icon:t}},I=function(){return{class:"backoffice-layers"}},z=function(e,t){return{id:"zones",name:"Zones",count:e,icon:t}},D=function(){return{class:"backoffice-stopwatch"}},T=function(e,t){return{id:"triggers",name:"Triggers",count:e,icon:t}},L=function(e,t,n,i){return[e,t,n,i]},A=((i=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,o,c){var r;return _classCallCheck(this,n),(r=t.call(this,e,i,o))._service=e,r._route=i,r._router=o,r._dialog=c,r.service=r._service.Systems,r}return _createClass(n,[{key:"ngOnInit",value:function(){_get(_getPrototypeOf(n.prototype),"ngOnInit",this).call(this),this._service.title="Systems"}},{key:"loadValues",value:function(){var e=this;this._service.Systems.listTriggers(this.item.id).then((function(t){return e.trigger_count=t.length||0})),this.device_count=(this.item.modules||[]).length,this.zone_count=(this.item.zones||[]).length}},{key:"newItem",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.modal_ref||(this.modal_ref=this._dialog.open(y.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:t?new h.p(Object.assign(Object.assign({},this.item),{id:"",name:"".concat(this.item.name," (1)")})):new h.p,service:this._service.Systems}}),this.subscription("modal_events",this.modal_ref.componentInstance.event.subscribe((function(t){"done"===t.reason&&e._router.navigate(["/systems",t.metadata.item.id])}))),this.modal_ref.afterClosed().subscribe((function(){e.unsub("modal_events"),e.modal_ref=null})))}},{key:"editItem",value:function(){var e=this;console.log("Edit"),this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(y.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Systems}}),this.modal_ref.afterClosed().subscribe((function(){e.unsub("modal_events"),e.modal_ref=null})))}},{key:"deleteItem",value:function(){var e=this;this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(O.b,Object.assign(Object.assign({},O.a),{data:{title:"Delete system",content:"<p>Are you sure you want delete this system?</p><p>Deleting this will <strong>immediately</strong> delete modules that are not in another system</p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("modal_events",this.modal_ref.componentInstance.event.subscribe((function(t){"done"===t.reason&&(e.modal_ref.componentInstance.loading="Deleting system...",e.item.delete().then((function(){e._service.notifySuccess('Successfully deleted system "'.concat(e.item.name,'".')),e._service.set("BACKOFFICE.removed",e.item.id),e._router.navigate(["/systems"]),e.modal_ref.close()}),(function(t){e.modal_ref.componentInstance.loading=null,e._service.notifyError("Error deleting system. Error: ".concat(JSON.stringify(t.response||t.message||t)))})))}))),this.modal_ref.afterClosed().subscribe((function(){e.unsub("modal_events"),e.modal_ref=null})))}}]),n}(v.a)).\u0275fac=function(e){return new(e||i)(w.Rb(C.a),w.Rb(p.a),w.Rb(p.c),w.Rb(P.b))},i.\u0275cmp=w.Lb({type:i,selectors:[["app-systems"]],features:[w.Ab],decls:5,vars:27,consts:[[1,"container"],[1,"sidebar"],["heading","Systems",3,"module","close","event"],[3,"touchrelease"],["name","system","route","systems",3,"item","loading","tabs","event"]],template:function(e,t){1&e&&(w.Xb(0,"div",0),w.Xb(1,"div",1),w.Xb(2,"sidebar",2),w.mc("event",(function(e){return t.sidebarEvent(e)})),w.Wb(),w.Wb(),w.Xb(3,"main",3),w.mc("touchrelease",(function(){return t.show_sidebar=!1})),w.Xb(4,"item-display",4),w.mc("event",(function(e){return t.itemEvent(e)})),w.Wb(),w.Wb(),w.Wb()),2&e&&(w.Hb("show",t.show_sidebar),w.Db(2),w.wc("module",t.module)("close",t.show_sidebar),w.Db(2),w.wc("item",t.item)("loading",t.loading_item)("tabs",w.Bc(22,L,w.yc(8,S,w.xc(7,j)),w.zc(11,X,t.device_count,w.xc(10,W)),w.zc(15,z,t.zone_count,w.xc(14,I)),w.zc(19,T,t.trigger_count,w.xc(18,D)))))},directives:[x.a,M.b,k.a],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}@media only screen and (orientation:landscape) and (max-width:800px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;flex:1;background-color:#f0f0f0}@media only screen and (orientation:portrait) and (max-width:450px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}"]}),i),E=n("mrSG"),R=n("5f3J"),q=n("bTqV"),$=n("+BlP"),F=n("Xa2L"),H=n("oIn+");function N(e,t){if(1&e&&(w.Xb(0,"div",9),w.Xb(1,"label"),w.bc(2,a),w.Wb(),w.Xb(3,"div",10),w.Xb(4,"a",11),w.Rc(5),w.Wb(),w.Wb(),w.Wb()),2&e){var n=w.qc(2);w.Db(4),w.wc("href",n.item.support_url,w.Kc),w.Db(1),w.Sc(n.item.support_url)}}function B(e,t){if(1&e&&(w.Xb(0,"div",9),w.Xb(1,"label"),w.bc(2,s),w.Wb(),w.Xb(3,"div",10),w.Rc(4),w.Wb(),w.Wb()),2&e){var n=w.qc(2);w.Db(4),w.Sc(n.item.bookable?"Yes":"No")}}function J(e,t){if(1&e&&(w.Xb(0,"a",11),w.Rc(1),w.Wb()),2&e){var n=w.qc(3);w.wc("href","mailto:"+n.item.email,w.Kc),w.Db(1),w.Sc(n.item.email)}}function Y(e,t){if(1&e&&(w.Xb(0,"div",9),w.Xb(1,"label"),w.bc(2,l),w.Wb(),w.Pc(3,J,2,2,"a",12),w.Wb()),2&e){var n=w.qc(2);w.Db(3),w.wc("ngIf",n.item.email)}}function Z(e,t){if(1&e&&(w.Xb(0,"div",9),w.Xb(1,"label"),w.bc(2,d),w.Wb(),w.Xb(3,"div",10),w.Rc(4),w.Wb(),w.Wb()),2&e){var n=w.qc(2);w.Db(4),w.Sc(n.item.capacity)}}function K(e,t){if(1&e&&(w.Xb(0,"div",9),w.Xb(1,"label"),w.bc(2,u),w.Wb(),w.Xb(3,"div",10),w.Rc(4),w.Wb(),w.Wb()),2&e){var n=w.qc(2);w.Db(4),w.Sc(n.item.installed_ui_devices)}}function U(e,t){if(1&e&&(w.Xb(0,"div",9),w.Xb(1,"label"),w.bc(2,b),w.Wb(),w.Xb(3,"div",10),w.Rc(4),w.rc(5,"dateFrom"),w.Wb(),w.Wb()),2&e){var n=w.qc(2);w.Db(4),w.Sc(w.sc(5,1,1e3*n.item.created_at))}}function V(e,t){if(1&e&&(w.Xb(0,"div",9),w.Xb(1,"label"),w.bc(2,m),w.Wb(),w.Xb(3,"div",10),w.Rc(4),w.rc(5,"dateFrom"),w.Wb(),w.Wb()),2&e){var n=w.qc(2);w.Db(4),w.Sc(w.sc(5,1,1e3*n.item.updated_at))}}o=$localize(_templateObject()),c=$localize(_templateObject2()),r=$localize(_templateObject3()),a=$localize(_templateObject4()),s=$localize(_templateObject5()),l=$localize(_templateObject6()),d=$localize(_templateObject7()),u=$localize(_templateObject8()),b=$localize(_templateObject9()),m=$localize(_templateObject10());var G,Q=function(){return[]};function ee(e,t){if(1&e&&(w.Xb(0,"section"),w.Sb(1,"a-settings-form",13),w.Wb()),2&e){var n=w.qc(2);w.Db(1),w.wc("id",n.item.id)("merge",!0)("settings",n.item.settings)("merge_settings",n.other_settings||w.xc(4,Q))}}function te(e,t){if(1&e){var n=w.Yb();w.Xb(0,"div",2),w.Xb(1,"section",3),w.Xb(2,"button",4),w.mc("tapped",(function(){return w.Hc(n),w.qc().start()})),w.bc(3,o),w.Wb(),w.Xb(4,"button",4),w.mc("tapped",(function(){return w.Hc(n),w.qc().stop()})),w.bc(5,c),w.Wb(),w.Wb(),w.Xb(6,"section",5),w.Pc(7,N,6,2,"div",6),w.Pc(8,B,5,1,"div",6),w.Pc(9,Y,4,1,"div",6),w.Pc(10,Z,5,1,"div",6),w.Pc(11,K,5,1,"div",6),w.Pc(12,U,6,3,"div",6),w.Pc(13,V,6,3,"div",6),w.Wb(),w.Sb(14,"hr"),w.Xb(15,"header",7),w.bc(16,r),w.Wb(),w.Pc(17,ee,2,5,"section",8),w.Wb()}if(2&e){var i=w.qc(),a=w.Ec(2);w.Db(7),w.wc("ngIf",i.item.support_url),w.Db(1),w.wc("ngIf",i.item.bookable),w.Db(1),w.wc("ngIf",i.item.bookable&&i.item.email),w.Db(1),w.wc("ngIf",i.item.capacity),w.Db(1),w.wc("ngIf",i.item.installed_ui_devices),w.Db(1),w.wc("ngIf",i.item.created_at),w.Db(1),w.wc("ngIf",i.item.updated_at),w.Db(4),w.wc("ngIf",!i.loading_settings)("ngIfElse",a)}}function ne(e,t){1&e&&(w.Xb(0,"div",14),w.Xb(1,"div",15),w.Sb(2,"mat-spinner",16),w.Wb(),w.Xb(3,"div",17),w.bc(4,G),w.Wb(),w.Wb())}G=$localize(_templateObject11());var ie,oe,ce,re,ae,se,le,de,ue,be=((ie=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i){var o;return _classCallCheck(this,n),(o=t.call(this))._service=e,o._dialog=i,o.other_settings=[],o}return _createClass(n,[{key:"modules",value:function(){return _toConsumableArray(this.item.modules)}},{key:"ngOnInit",value:function(){var e=this;this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe((function(t){e.item=t,e.loadZones(),e.loadSettings()})))}},{key:"ngOnChanges",value:function(e){e.item&&this.item&&(this.loadZones(),this.loadSettings())}},{key:"start",value:function(){var e=this,t=this._dialog.open(O.b,Object.assign(Object.assign({},O.a),{data:{title:"Start system?",content:"Are you sure you want to start this system?<br>All stopped modules within the system will boot up.",icon:{type:"icon",class:"backoffice-controller-play"}}}));this.subscription("confirm_ref",t.componentInstance.event.subscribe((function(t){"done"===t.reason&&e._service.Systems.startSystem(e.item.id).then((function(e){return null}),(function(t){return e._service.notifyError("Failed to start system: ".concat(JSON.stringify(t.response||t.message||t)))}))})))}},{key:"stop",value:function(){var e=this,t=this._dialog.open(O.b,Object.assign(Object.assign({},O.a),{data:{title:"Stop system?",content:"Are you sure you want to stop this system?<br>All modules will be immediately stopped regardless of any other systems they may be in.",icon:{type:"icon",class:"backoffice-controller-stop"}}}));this.subscription("confirm_ref",t.componentInstance.event.subscribe((function(t){"done"===t.reason&&e._service.Systems.stopSystem(e.item.id).then((function(e){return null}),(function(t){return e._service.notifyError("Failed to stop system: ".concat(JSON.stringify(t.response||t.message||t)))}))})))}},{key:"loadZones",value:function(){var e=this;this.item&&this._service.Zones.query({control_system_id:this.item.id,offset:0}).then((function(t){t.sort((function(t,n){return e.item.zones.indexOf(n.id)-e.item.zones.indexOf(t.id)})),e.zones=t}),(function(){return null}))}},{key:"loadSettings",value:function(){return Object(E.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.item,!e.t0){e.next=5;break}return e.next=4,this._service.Systems.settings(this.item.id);case 4:this.other_settings=e.sent;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"loading_settings",get:function(){return this._service.get("loading_settings")}}]),n}(R.a)).\u0275fac=function(e){return new(e||ie)(w.Rb(C.a),w.Rb(P.b))},ie.\u0275cmp=w.Lb({type:ie,selectors:[["system-about"]],inputs:{item:"item"},features:[w.Ab,w.Bb],decls:3,vars:1,consts:[["class","container",4,"ngIf"],["load_state",""],[1,"container"],[1,"select"],["mat-button","",3,"tapped"],[1,"details"],["class","field",4,"ngIf"],[1,"settings"],[4,"ngIf","ngIfElse"],[1,"field"],[1,"value"],["target","_blank",3,"href"],["target","_blank",3,"href",4,"ngIf"],[3,"id","merge","settings","merge_settings"],[1,"info-block"],[1,"icon"],["diameter","48"],[1,"text"]],template:function(e,t){1&e&&(w.Pc(0,te,18,9,"div",0),w.Pc(1,ne,5,0,"ng-template",null,1,w.Qc)),2&e&&w.wc("ngIf",t.item)},directives:[f.m,q.b,M.b,$.a,F.b],pipes:[H.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}header[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:700;font-size:1.1em;margin-bottom:.5em}header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.7em;color:rgba(0,0,0,.6);padding:0 1em;font-weight:300;text-decoration:underline;cursor:pointer;transition:color .2s}header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{color:rgba(0,0,0,.85)}header.settings[_ngcontent-%COMP%]{position:relative;top:.75em;margin:0}section[_ngcontent-%COMP%]{padding:.5em .25em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:.25em}button[_ngcontent-%COMP%]{margin:0 .25em}button[_ngcontent-%COMP%]:first-child{margin-left:0}button[_ngcontent-%COMP%]:last-child{margin-right:0}.field[_ngcontent-%COMP%]{display:flex;align-items:center;margin:.25em 0}.field[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{padding:0 .5em;-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all}label[_ngcontent-%COMP%]{font-size:.8em;font-weight:500}a[_ngcontent-%COMP%]{font-size:.9em}"]}),ie),me=n("DuJs"),fe=n("av/m"),ge=n("cqYI"),pe=n("GrRB"),_e=n("Mj3r"),he=n("EY9O"),ve=n("Qu3c"),ye=n("bSwM"),Oe=n("STbY"),we=n("0njA"),Ce=n("Cvi9");function Pe(e,t){if(1&e&&(w.Vb(0),w.Xb(1,"section",10),w.Xb(2,"h3"),w.bc(3,ae),w.Wb(),w.Sb(4,"system-exec-field",11),w.Wb(),w.Ub()),2&e){var n=w.qc(2);w.Db(4),w.wc("system",n.item)}}function xe(e,t){if(1&e){var n=w.Yb();w.Xb(0,"i",34),w.mc("modelChange",(function(e){return w.Hc(n),w.qc().$implicit.connected=e})),w.Wb()}if(2&e){var i=w.qc().$implicit,o=w.qc(3);w.wc("model",i.connected)("sys",o.item.id)("mod",o.device_classes[i.id])}}function Me(e,t){1&e&&w.Sb(0,"i",35)}function ke(e,t){if(1&e){var n=w.Yb();w.Xb(0,"button",36),w.mc("tapped",(function(){w.Hc(n);var e=t.$implicit,i=w.qc().$implicit;return w.qc(3).handleContextEvent(e,i)})),w.Sb(1,"app-icon",30),w.Xb(2,"div",37),w.Rc(3),w.Wb(),w.Wb()}if(2&e){var i=t.$implicit;w.Db(1),w.wc("icon",i.icon),w.Db(2),w.Sc(i.name)}}function je(e,t){1&e&&w.Sb(0,"td",38)}oe=$localize(_templateObject12()),ce=$localize(_templateObject13()),re=$localize(_templateObject14()),ae=$localize(_templateObject15()),se=$localize(_templateObject16()),le=$localize(_templateObject17()),de=$localize(_templateObject18()),ue=$localize(_templateObject19());var Se=function(e){return["/modules",e]},We=function(){return{class:"backoffice-dots-three-vertical"}};function Xe(e,t){if(1&e){var n=w.Yb();w.Xb(0,"tr",18),w.mc("contextAction",(function(e){w.Hc(n);var i=t.$implicit;return w.qc(3).handleContextEvent(e,i)})),w.Xb(1,"td",12),w.Xb(2,"div",19),w.Sb(3,"i",20),w.Wb(),w.Wb(),w.Xb(4,"td",12),w.Pc(5,xe,1,3,"i",21),w.Xb(6,"div",22),w.mc("tapped",(function(){w.Hc(n);var e=t.$implicit;return w.qc(3).power(e)})),w.Wb(),w.Wb(),w.Xb(7,"td",13),w.Xb(8,"a",23),w.mc("contextmenu",(function(e){return w.Hc(n),e.stopPropagation()})),w.Rc(9),w.Wb(),w.Wb(),w.Xb(10,"td",14),w.Xb(11,"mat-checkbox",24),w.mc("change",(function(){w.Hc(n);var e=t.$implicit;return w.qc(3).toggleDebugEvents(e)})),w.Rc(12),w.Wb(),w.Wb(),w.Xb(13,"td",15),w.Xb(14,"div",25),w.Pc(15,Me,1,0,"i",26),w.Wb(),w.Xb(16,"a",27),w.Rc(17),w.Wb(),w.Wb(),w.Xb(18,"td",28),w.Xb(19,"button",29),w.Sb(20,"app-icon",30),w.Wb(),w.Xb(21,"mat-menu",null,31),w.Pc(23,ke,4,2,"button",32),w.Wb(),w.Wb(),w.Pc(24,je,1,0,"td",33),w.Wb()}if(2&e){var i=t.$implicit,o=w.Ec(22),c=w.qc(3);w.wc("context-menu",o)("offset_y",-64),w.Db(5),w.wc("ngIf",i&&c.item.id),w.Db(1),w.Hb("active",i.running&&"true"===i.connected)("inactive",i.running&&"false"===i.connected)("black",!i.running),w.Db(2),w.wc("routerLink",w.yc(20,Se,i.id))("matTooltip",i.id),w.Db(1),w.Sc((null==i.driver?null:i.driver.name)||"<Unnamed>"),w.Db(2),w.wc("checked",c.debugged_modules[i.id]),w.Db(1),w.Tc(" ",c.device_classes[i.id]," "),w.Db(3),w.wc("ngIf",i.tls),w.Db(1),w.wc("href",(i.tls?"https://":"http://")+i.ip,w.Kc),w.Db(1),w.Sc(i.ip),w.Db(2),w.wc("matMenuTriggerFor",o),w.Db(1),w.wc("icon",w.xc(22,We)),w.Db(3),w.wc("ngForOf",i.running?c.menu_options:c.offline_options)}}var Ie,ze=function(){return[]};function De(e,t){if(1&e){var n=w.Yb();w.Xb(0,"table"),w.Xb(1,"thead"),w.Sb(2,"td",12),w.Xb(3,"td",12),w.bc(4,se),w.Wb(),w.Xb(5,"td",13),w.bc(6,le),w.Wb(),w.Xb(7,"td",14),w.bc(8,de),w.Wb(),w.Xb(9,"td",15),w.bc(10,ue),w.Wb(),w.Sb(11,"td",12),w.Wb(),w.Xb(12,"tbody",16),w.mc("cdkDropListDropped",(function(e){return w.Hc(n),w.qc(2).drop(e)})),w.Pc(13,Xe,25,23,"tr",17),w.Wb(),w.Wb()}if(2&e){var i=w.qc(2);w.Db(13),w.wc("ngForOf",i.devices||w.xc(1,ze))}}function Te(e,t){1&e&&(w.Xb(0,"div",39),w.Xb(1,"div",37),w.bc(2,Ie),w.Wb(),w.Wb())}function Le(e,t){if(1&e){var n=w.Yb();w.Xb(0,"div",1),w.Xb(1,"section",2),w.Xb(2,"div",3),w.Xb(3,"item-search-field",4),w.mc("ngModelChange",(function(e){return w.Hc(n),w.qc().new_module=e.id})),w.Wb(),w.Wb(),w.Xb(4,"button",5),w.mc("tapped",(function(){return w.Hc(n),w.qc().addModule()})),w.bc(5,oe),w.Wb(),w.Xb(6,"button",6),w.mc("tapped",(function(){return w.Hc(n),w.qc().newModule()})),w.bc(7,ce),w.Wb(),w.Wb(),w.Pc(8,Pe,5,1,"ng-container",7),w.Xb(9,"section",8),w.Xb(10,"h3"),w.bc(11,re),w.Wb(),w.Pc(12,De,14,2,"table",7),w.Pc(13,Te,3,0,"div",9),w.Wb(),w.Wb()}if(2&e){var i=w.qc();w.Db(3),w.wc("service",i.module_service)("exclude",i.exclude_fn)("ngModel",null),w.Db(1),w.wc("disabled",!i.new_module),w.Db(4),w.wc("ngIf",i.item.id&&i.item.modules&&!i.hide_exec),w.Db(4),w.wc("ngIf",i.devices&&i.devices.length>0),w.Db(1),w.wc("ngIf",!i.devices||i.devices.length<=0)}}Ie=$localize(_templateObject20());var Ae,Ee,Re,qe,$e,Fe=((Ae=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,o){var c;return _classCallCheck(this,n),(c=t.call(this))._service=e,c._dialog=i,c._debug_service=o,c.device_classes={},c.device_listener={},c.menu_options=[{id:"power",name:"Toggle Power",icon:{type:"icon",class:"backoffice-power-plug"}},{id:"state",name:"View State",icon:{type:"icon",class:"backoffice-eye"}},{id:"reload",name:"Recompile Driver",icon:{type:"icon",class:"backoffice-cw"}},{id:"remove",name:"Remove Module",icon:{type:"icon",class:"backoffice-trash"}},{id:"load",name:"Load Module",icon:{type:"icon",class:"backoffice-arrow-with-circle-up"}}],c.offline_options=[{id:"power",name:"Toggle Power",icon:{type:"icon",class:"backoffice-power-plug"}},{id:"remove",name:"Remove Module",icon:{type:"icon",class:"backoffice-trash"}},{id:"load",name:"Load Module",icon:{type:"icon",class:"backoffice-arrow-with-circle-up"}}],c.exclude_fn=function(e){return e.control_system_id===c.item.id||e.role===h.h.Logic},c}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe((function(t){e.item=t,e.loadModules()})))}},{key:"ngOnChanges",value:function(e){e.item&&this.loadModules()}},{key:"loadModules",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.item&&this._service.Modules.query({control_system_id:this.item.id,complete:!0,offset:t}).then((function(t){t.sort((function(t,n){return e.item.modules.indexOf(t.id)-e.item.modules.indexOf(n.id)})),e.devices=t,e.generateModuleBindings()}),(function(){return null}))}},{key:"handleContextEvent",value:function(e,t){if(e)switch(e.id){case"power":this.power(t);break;case"state":this.viewState(t);break;case"reload":this.reloadModule(t);break;case"remove":this.remove(t);break;case"load":this.loadModule(t)}}},{key:"power",value:function(e){var t=this;this.hide_exec=!0,e.running?e.stop().then((function(){t.hide_exec=!1,t._service.notifySuccess("Module successfully stopped"),e.running=!1}),(function(n){t.hide_exec=!1,"string"==typeof n&&n.length<64?t._service.notifyError(n):t._service.notifyError("Failed to stop module '".concat(e.id,"'.\nView Error?"),"View",(function(){return t.viewDetails(n)}))})):e.start().then((function(){t.hide_exec=!1,t._service.notifySuccess("Module successfully started"),e.running=!0}),(function(n){t.hide_exec=!1,"string"==typeof n&&n.length<64?t._service.notifyError(n):t._service.notifyError("Failed to start module '".concat(e.id,"'.\nView Error?"),"View",(function(){return t.viewDetails(n)}))}))}},{key:"reload",value:function(e){this._service.Modules.show(e.id).then((function(t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}),(function(){return null}))}},{key:"viewState",value:function(e){this._dialog.open(me.a,{data:{system:this.item,module:e,devices:this.devices}})}},{key:"reloadModule",value:function(e){var t=this,n=this._dialog.open(O.b,Object.assign(Object.assign({},O.a),{data:{title:"Recompile module?",content:"New driver code will be loaded and the device settings will be reloaded.",icon:{type:"icon",class:"backoffice-install"}}}));this.subscription("confirm_ref",n.componentInstance.event.subscribe((function(i){"done"===i.reason&&((e.driver?e.driver.recompile():t._service.Drivers.recompile(e.driver_id)).then((function(e){return t._service.notifySuccess("Driver successfully recompiled.")}),(function(e){return t._service.notifyError(JSON.stringify(e.response||e.message||e))})),n.close(),t.unsub("confirm_ref"))})))}},{key:"loadModule",value:function(e){var t=this;this._service.Modules.load(e.id).then((function(){return t._service.notifySuccess('Successfully loaded module "'.concat(e.name||e.id,'"'))}),(function(e){return t._service.notifyError("Error loading module. Error: ".concat(JSON.stringify(e.response||e.message||e)))}))}},{key:"viewDetails",value:function(e){this._dialog.open(fe.a,{data:{content:e}})}},{key:"drop",value:function(e){var t=this;if(e&&e.previousIndex!==e.currentIndex){var n=this._dialog.open(O.b,Object.assign(Object.assign({},O.a),{data:{title:"Change order?",content:"Are you sure you want to change the module priority?<br>Settings will be updated immediately for the system.",icon:{type:"icon",class:"backoffice-layers"}}}));this.subscription("confirm_ref",n.componentInstance.event.subscribe((function(i){if("done"===i.reason){t.hide_exec=!0,n.componentInstance.loading="Updating module order...";var o=_toConsumableArray(t.item.modules);Object(_.f)(o,e.previousIndex,e.currentIndex),t.item.storePendingChange("modules",o),t.item.save().then((function(){t.hide_exec=!1,n.close(),t.unsub("confirm_ref")}),(function(e){t.hide_exec=!1,n.componentInstance.loading=null,t._service.notifyError("Error reording modules. Error: ".concat(JSON.stringify(e.response||e.message||e)))}))}})))}}},{key:"remove",value:function(e){var t=this,n=this._dialog.open(O.b,Object.assign(Object.assign({},O.a),{data:{title:"Remove module?",content:"Remove ".concat(e.driver_id," from this system?<br>If this is not used elsewhere the associated data will be removed immediately."),icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("confirm_ref",n.componentInstance.event.subscribe((function(i){"done"===i.reason&&(t.hide_exec=!0,t.item.removeModule(e.id).then((function(){t.hide_exec=!1,t._service.notifySuccess("Succefully removed module."),t.devices.splice(t.devices.indexOf(e),1),n.close(),t.unsub("confirm_ref")}),(function(e){t.hide_exec=!1,t._service.notifyError("Error removing module. Error: ".concat(JSON.stringify(e.response||e.message||e))),n.close(),t.unsub("confirm_ref")})))})))}},{key:"newModule",value:function(){var e=this,t=this._dialog.open(y.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new h.j({control_system_id:this.item.id,control_system:this.item}),service:this._service.Modules,readonly:!0}});this.subscription("modal_events",t.componentInstance.event.subscribe((function(t){"done"===t.reason&&(e.hide_exec=!0,e._service.Systems.addModule(e.item.id,t.metadata.item.id).then((function(){e.hide_exec=!1,e.item=new h.p(Object.assign(Object.assign({},e.item),{modules:e.item.modules.concat(t.metadata.item.id),version:e.item._version++})),e._service.set("BACKOFFICE.active_item",e.item),e.timeout("reload_module_list",(function(){return e.loadModules()}),1e3)}),(function(t){e.hide_exec=!1})))}))),t.afterClosed().subscribe((function(){e.unsub("modal_events")}))}},{key:"addModule",value:function(){this.new_module&&(this.joinModule(this.new_module),this.new_module="")}},{key:"joinModule",value:function(e){var t=this,n=_toConsumableArray(this.item.modules);n.indexOf(e)<0&&n.push(e),this.hide_exec=!0,this.item.storePendingChange("modules",n),this._service.Systems.addModule(this.item.id,e).then((function(){t.hide_exec=!1,t.item=new h.p(Object.assign(Object.assign({},t.item),{modules:t.item.modules.concat(e),version:t.item._version++})),t._service.notifySuccess("Successfully added device to system"),t.loadModules()}),(function(){t.hide_exec=!1,t._service.notifyError("Failed to add module to system")}))}},{key:"toggleDebugEvents",value:function(e){e&&(this._debug_service.isListening(e)?this._debug_service.unbind(e):this._debug_service.bind(e,this.device_classes[e.id]))}},{key:"generateModuleBindings",value:function(){var e,t={},n=_createForOfIteratorHelper(this.devices);try{for(n.s();!(e=n.n()).done;){var i=e.value,o=i.custom_name||i.name||"Blank";t[o]||(t[o]=0),this.device_classes[i.id]="".concat(o,"_").concat(++t[o])}}catch(c){n.e(c)}finally{n.f()}}},{key:"module_service",get:function(){return this._service.Modules}},{key:"debugged_modules",get:function(){var e=this;return this.devices.reduce((function(t,n){return t[n.id]=e._debug_service.isListening(n),t}),{})}}]),n}(R.a)).\u0275fac=function(e){return new(e||Ae)(w.Rb(C.a),w.Rb(P.b),w.Rb(ge.a))},Ae.\u0275cmp=w.Lb({type:Ae,selectors:[["system-modules"]],inputs:{item:"item"},features:[w.Ab,w.Bb],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"select"],[1,"dropdown"],[3,"service","exclude","ngModel","ngModelChange"],["mat-button","",3,"disabled","tapped"],["mat-button","",3,"tapped"],[4,"ngIf"],[1,"device-list"],["class","info-block",4,"ngIf"],[1,"exec"],[3,"system"],[1,"small"],[1,"name"],[1,"module"],[1,"ip"],["cdkDropList","",3,"cdkDropListDropped"],["cdkDrag","",3,"context-menu","offset_y","contextAction",4,"ngFor","ngForOf"],["cdkDrag","",3,"context-menu","offset_y","contextAction"],["cdkDragHandle","",1,"action","grab"],[1,"backoffice-select-arrows"],["binding","","bind","connected",3,"model","sys","mod","modelChange",4,"ngIf"],[1,"state",3,"tapped"],["routerLinkActive","router-link-active",3,"routerLink","matTooltip","contextmenu"],[3,"checked","change"],[1,"lock"],["class","backoffice-lock",4,"ngIf"],[3,"href"],["touchrelease","",1,"small"],["mat-icon-button","",3,"matMenuTriggerFor"],[3,"icon"],["menu","matMenu"],["mat-menu-item","",3,"tapped",4,"ngFor","ngForOf"],["class","placeholder","colspan","6",4,"cdkDragPlaceholder"],["binding","","bind","connected",3,"model","sys","mod","modelChange"],[1,"backoffice-lock"],["mat-menu-item","",3,"tapped"],[1,"text"],["colspan","6",1,"placeholder"],[1,"info-block"]],template:function(e,t){1&e&&w.Pc(0,Le,14,7,"div",0),2&e&&w.wc("ngIf",t.item)},directives:[f.m,pe.a,g.l,g.o,q.b,M.b,_e.a,_.d,f.l,_.a,he.a,_.b,p.f,p.e,ve.a,ye.a,Oe.c,we.a,Oe.d,_.c,Ce.a,Oe.a],styles:[".container[_ngcontent-%COMP%]{position:absolute;display:flex;flex-direction:column;top:4em;left:0;right:0;bottom:0;overflow:hidden}.options[_ngcontent-%COMP%]{display:flex;font-size:1.2em;max-width:5em;margin:0}.dropdown[_ngcontent-%COMP%]{flex:1;height:3.25em}mat-form-field[_ngcontent-%COMP%]{flex:1}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1;width:5em}.table-row[_ngcontent-%COMP%]   .module[_ngcontent-%COMP%]{width:10em;min-width:7em}.placeholder[_ngcontent-%COMP%]{background:#ccc;border:3px dotted #999;min-height:3em;transition:transform .25s cubic-bezier(0,0,.2,1)}.device-list[_ngcontent-%COMP%]{flex:1;min-height:8em;overflow:auto;padding:0 1em}h3[_ngcontent-%COMP%]{margin:.5em 0}.exec[_ngcontent-%COMP%]{padding:0 1em}.lock[_ngcontent-%COMP%]{height:1.2em;width:1.2em;display:inline-flex;align-items:center;justify-content:center}.state[_ngcontent-%COMP%]{height:16px;width:16px;margin:.25em;background-color:#000;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.inactive[_ngcontent-%COMP%]{background-color:#f44336}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:8px;width:8px;margin:8px}.state.black[_ngcontent-%COMP%]{background-color:#000}.terminal[_ngcontent-%COMP%]{padding-top:.5em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:.5em 1em 0}@media only screen and (orientation:portrait) and (max-width:450px){.select[_ngcontent-%COMP%]{flex-wrap:wrap}}@media only screen and (orientation:landscape) and (max-width:800px){.select[_ngcontent-%COMP%]{flex-wrap:wrap}}@media only screen and (orientation:portrait) and (max-width:450px){.select[_ngcontent-%COMP%]   .dropdown[_ngcontent-%COMP%]{min-width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.select[_ngcontent-%COMP%]   .dropdown[_ngcontent-%COMP%]{min-width:100%}}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .25em}@media only screen and (orientation:portrait) and (max-width:450px){.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:.25em;flex:1}}@media only screen and (orientation:landscape) and (max-width:800px){.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:.25em;flex:1}}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}@media only screen and (orientation:portrait) and (max-width:450px){.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){margin-left:0}}@media only screen and (orientation:landscape) and (max-width:800px){.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){margin-left:0}}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{margin-right:0}.grab[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.placeholder[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.1);border:4px dashed rgba(0,0,0,.6);height:2em}.mat-menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:0 1em}.mat-menu-item[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.2em}.mat-menu-item[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{flex:1;min-width:50%;margin-left:.5em}"]}),Ae),He=n("uxQG"),Ne=n("kmnG"),Be=n("qFsG");Ee=$localize(_templateObject21()),Re=$localize(_templateObject22()),qe=$localize(_templateObject23()),$e=$localize(_templateObject24());var Je=function(e){return["/triggers",e]},Ye=function(){return{class:"backoffice-edit"}},Ze=function(){return{class:"backoffice-trash"}};function Ke(e,t){if(1&e){var n=w.Yb();w.Xb(0,"tr"),w.Xb(1,"td",13),w.Sb(2,"div",19),w.Wb(),w.Xb(3,"td",14),w.Xb(4,"a",20),w.Rc(5),w.Wb(),w.Wb(),w.Xb(6,"td",15),w.Rc(7),w.Wb(),w.Xb(8,"td",16),w.Rc(9),w.rc(10,"dateFrom"),w.Wb(),w.Xb(11,"td",17),w.Xb(12,"div",21),w.Xb(13,"button",22),w.mc("tapped",(function(){w.Hc(n);var e=t.$implicit;return w.qc(3).editTrigger(e)})),w.Sb(14,"app-icon",9),w.Wb(),w.Xb(15,"button",22),w.mc("tapped",(function(){w.Hc(n);var e=t.$implicit;return w.qc(3).deleteTrigger(e)})),w.Sb(16,"app-icon",9),w.Wb(),w.Wb(),w.Wb(),w.Wb()}if(2&e){var i=t.$implicit;w.Db(2),w.Hb("active",i.enabled),w.Db(2),w.wc("routerLink",w.yc(11,Je,i.id))("matTooltip",i.id),w.Db(1),w.Sc(i.name),w.Db(2),w.Sc(i.activated_count||"0"),w.Db(2),w.Sc(w.sc(10,9,1e3*(i.created_at-0))),w.Db(5),w.wc("icon",w.xc(13,Ye)),w.Db(2),w.wc("icon",w.xc(14,Ze))}}function Ue(e,t){if(1&e&&(w.Xb(0,"table"),w.Xb(1,"thead"),w.Sb(2,"td",13),w.Xb(3,"td",14),w.bc(4,Re),w.Wb(),w.Xb(5,"td",15),w.bc(6,qe),w.Wb(),w.Xb(7,"td",16),w.bc(8,$e),w.Wb(),w.Sb(9,"td",17),w.Wb(),w.Xb(10,"tbody"),w.Pc(11,Ke,17,15,"tr",18),w.Wb(),w.Wb()),2&e){var n=w.qc(2);w.Db(11),w.wc("ngForOf",n.trigger_list)}}var Ve,Ge=function(){return{class:"backoffice-magnifying-glass"}};function Qe(e,t){if(1&e){var n=w.Yb();w.Xb(0,"div",2),w.Xb(1,"div",3),w.Xb(2,"section",4),w.Xb(3,"div",5),w.Xb(4,"button",6),w.mc("tapped",(function(){return w.Hc(n),w.qc().selectTriggerToAdd()})),w.bc(5,Ee),w.Wb(),w.Wb(),w.Xb(6,"mat-form-field",7),w.Xb(7,"div",8),w.Sb(8,"app-icon",9),w.Wb(),w.Xb(9,"input",10),w.mc("ngModelChange",(function(e){return w.Hc(n),w.qc().search_str=e})),w.Wb(),w.Wb(),w.Wb(),w.Xb(10,"section",11),w.Pc(11,Ue,12,1,"table",12),w.Wb(),w.Wb(),w.Wb()}if(2&e){var i=w.qc(),o=w.Ec(2);w.Db(8),w.wc("icon",w.xc(4,Ge)),w.Db(1),w.wc("ngModel",i.search_str),w.Db(2),w.wc("ngIf",i.trigger_list.length>0)("ngIfElse",o)}}function et(e,t){1&e&&(w.Xb(0,"div",23),w.Xb(1,"div",24),w.bc(2,Ve),w.Wb(),w.Wb())}Ve=$localize(_templateObject25());var tt,nt,it,ot=((tt=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,o){var c;return _classCallCheck(this,n),(c=t.call(this))._service=e,c._dialog=i,c._composer=o,c.trigger_list=[],c}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe((function(t){e.item=t,e.loadSystemTriggers()})))}},{key:"ngOnChanges",value:function(e){e.item&&this.loadSystemTriggers()}},{key:"loadSystemTriggers",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0],this.item&&this._service.Systems.listTriggers(this.item.id).then((function(t){e.trigger_list=t}),(function(){return null}))}},{key:"editTrigger",value:function(e){var t=this;if(this.item&&e){var n=this._dialog.open(y.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:e,service:this._service.Triggers,external_save:!0}});this.subscription("delete_confirm",n.componentInstance.event.subscribe((function(i){"action"===i.reason&&(n.componentInstance.loading="Saving trigger settings...",t._composer.http.put("".concat(t._composer.auth.api_endpoint,"/systems/").concat(t.item.id,"/triggers/").concat(e.id),e.toJSON(!0)).subscribe((function(){return null}),(function(e){n.componentInstance.loading=null,t._service.notifyError("Error updating trigger settings. Error: ".concat(JSON.stringify(e.response||e.message||e)))}),(function(){t._service.notifySuccess("Successfully updated trigger settings."),n.close(),t.unsub("delete_confirm")})))})))}}},{key:"deleteTrigger",value:function(e){var t=this;if(this.item&&e){var n=this._dialog.open(O.b,Object.assign(Object.assign({},O.a),{data:{title:"Remove trigger",content:'<p>Are you sure you want remove trigger "'.concat(e.name,'"?</p><p>Configuration will be updated <strong>immediately</strong>.</p>'),icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",n.componentInstance.event.subscribe((function(i){"done"===i.reason&&(n.componentInstance.loading="Removing trigger...",t._composer.http.delete("".concat(t._composer.auth.api_endpoint,"/systems/").concat(t.item.id,"/triggers/").concat(e.id)).subscribe((function(){return null}),(function(e){n.componentInstance.loading=null,t._service.notifyError("Error removing trigger. Error: ".concat(JSON.stringify(e.response||e.message||e)))}),(function(){t._service.notifySuccess('Successfully deleted trigger "'.concat(t.item.name,'".')),n.close(),t.unsub("delete_confirm")})))})))}}},{key:"selectTriggerToAdd",value:function(){var e=this,t=this._dialog.open(He.a,{height:"auto",width:"auto",data:{service_name:"Triggers"}});this.subscription("dialog_events",t.componentInstance.event.subscribe((function(n){var i=t.componentInstance.item;"action"===n.reason&&i&&(e.addTrigger(i),t.close())}))),t.afterClosed().subscribe((function(){return e.unsub("dialog_events")}))}},{key:"addTrigger",value:function(e){this._service.Systems.addTrigger(this.item.id,{control_system_id:this.item.id,enabled:!0,important:!1,trigger_id:e.id})}}]),n}(R.a)).\u0275fac=function(e){return new(e||tt)(w.Rb(C.a),w.Rb(P.b),w.Rb(Ce.c))},tt.\u0275cmp=w.Lb({type:tt,selectors:[["system-triggers"]],inputs:{item:"item"},features:[w.Ab,w.Bb],decls:3,vars:1,consts:[["class","container",4,"ngIf"],["empty_state",""],[1,"container"],[1,"settings"],[1,"select"],[1,"dropdown"],["mat-button","",3,"tapped"],["appearance","outline"],["matPrefix","",1,"prefix"],[3,"icon"],["matInput","","name","search-filter","placeholder","Filter Triggers",3,"ngModel","ngModelChange"],[1,"list"],[4,"ngIf","ngIfElse"],[1,"small"],[1,"flex"],[1,"count"],[1,"added"],[1,"duo"],[4,"ngFor","ngForOf"],[1,"state"],[3,"routerLink","matTooltip"],[1,"actions"],["mat-icon-button","",3,"tapped"],[1,"info-block"],[1,"text"]],template:function(e,t){1&e&&(w.Pc(0,Qe,12,5,"div",0),w.Pc(1,et,3,0,"ng-template",null,1,w.Qc)),2&e&&w.wc("ngIf",t.item)},directives:[f.m,q.b,M.b,Ne.c,Ne.f,we.a,Be.a,g.b,g.l,g.o,f.l,p.f,ve.a],pipes:[H.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.list[_ngcontent-%COMP%]{margin-top:.5em}.table-row[_ngcontent-%COMP%]   .added[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{width:8em;min-width:8em}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.state[_ngcontent-%COMP%]{height:16px;width:16px;margin:.25em;background-color:#d32f2f;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:8px;width:8px;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center}.select[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1;min-width:50%}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .25em 1.5em}.select[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.25em}.duo[_ngcontent-%COMP%]{width:6em}.actions[_ngcontent-%COMP%]{display:flex}"]}),tt),ct=n("YxBP");function rt(e,t){1&e&&w.Sb(0,"td",9)}function at(e,t){if(1&e){var n=w.Yb();w.Xb(0,"td",9),w.Xb(1,"button",20),w.mc("tapped",(function(){w.Hc(n);var e=w.qc().$implicit;return w.qc(3).removeZone(e)})),w.Sb(2,"i",21),w.Wb(),w.Wb()}}function st(e,t){1&e&&w.Sb(0,"td",22)}nt=$localize(_templateObject26()),it=$localize(_templateObject27());var lt,dt=function(e){return["/zones",e]};function ut(e,t){if(1&e&&(w.Xb(0,"tr",15),w.Xb(1,"td",9),w.Xb(2,"div",16),w.Sb(3,"i",17),w.Wb(),w.Wb(),w.Xb(4,"td",10),w.Xb(5,"a",18),w.Rc(6),w.Wb(),w.Wb(),w.Xb(7,"td",11),w.Rc(8),w.Wb(),w.Pc(9,at,3,0,"td",12),w.Pc(10,st,1,0,"td",19),w.Wb()),2&e){var n=t.$implicit,i=w.qc(3);w.Db(5),w.wc("routerLink",w.yc(5,dt,n.id))("matTooltip",n.id),w.Db(1),w.Sc(n.name),w.Db(2),w.Sc(n.description),w.Db(1),w.wc("ngIf",i.zones.length>1)}}function bt(e,t){if(1&e){var n=w.Yb();w.Xb(0,"table"),w.Xb(1,"thead"),w.Sb(2,"td",9),w.Xb(3,"td",10),w.bc(4,nt),w.Wb(),w.Xb(5,"td",11),w.bc(6,it),w.Wb(),w.Pc(7,rt,1,0,"td",12),w.Wb(),w.Xb(8,"tbody",13),w.mc("cdkDropListDropped",(function(e){return w.Hc(n),w.qc(2).drop(e)})),w.Pc(9,ut,11,7,"tr",14),w.Wb(),w.Wb()}if(2&e){var i=w.qc(2);w.Db(7),w.wc("ngIf",i.zones.length>1),w.Db(2),w.wc("ngForOf",i.zones)}}function mt(e,t){1&e&&(w.Xb(0,"div",23),w.Xb(1,"div",24),w.bc(2,lt),w.Wb(),w.Wb())}function ft(e,t){if(1&e){var n=w.Yb();w.Xb(0,"div",1),w.Xb(1,"div",2),w.Xb(2,"section",3),w.Xb(3,"div",4),w.Xb(4,"item-search-field",5),w.mc("ngModelChange",(function(e){return w.Hc(n),w.qc().new_zone=e})),w.Wb(),w.Wb(),w.Xb(5,"button",6),w.mc("tapped",(function(){return w.Hc(n),w.qc().joinZone()})),w.Rc(6,"Join zone"),w.Wb(),w.Wb(),w.Xb(7,"section"),w.Pc(8,bt,10,2,"table",7),w.Pc(9,mt,3,0,"div",8),w.Wb(),w.Wb(),w.Wb()}if(2&e){var i=w.qc();w.Db(4),w.wc("service",i.zone_service)("exclude",i.exclude_fn)("ngModel",null),w.Db(1),w.wc("disabled",!i.new_zone),w.Db(3),w.wc("ngIf",i.zones&&i.zones.length>0),w.Db(1),w.wc("ngIf",!i.zones||i.zones.length<=0)}}lt=$localize(_templateObject28());var gt,pt=[{path:":id",component:A,children:[{path:"about",component:be},{path:"modules",component:Fe},{path:"triggers",component:ot},{path:"zones",component:(gt=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i){var o;return _classCallCheck(this,n),(o=t.call(this))._service=e,o._dialog=i,o.loading=new w.o,o.exclude_fn=function(e){return o.item.zones.indexOf(e.id)>=0},o}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe((function(t){e.item=t,e.loadZones()})))}},{key:"ngOnChanges",value:function(e){e.item&&this.loadZones()}},{key:"loadZones",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0],this.item&&this._service.Systems.listZones(this.item.id).then((function(t){t.sort((function(t,n){return e.item.zones.indexOf(t.id)-e.item.zones.indexOf(n.id)})),e.zones=t}),(function(){return null}))}},{key:"drop",value:function(e){var t=this;if(e&&e.previousIndex!==e.currentIndex){var n=this._dialog.open(O.b,Object.assign(Object.assign({},O.a),{data:{title:"Change order?",content:"Are you sure you want to change the zone priority?<br>Settings will be updated immediately for the system.",icon:{type:"icon",class:"backoffice-cycle"}}}));this.subscription("confirm_ref",n.componentInstance.event.subscribe((function(i){if("done"===i.reason){var o=_toConsumableArray(t.item.zones);Object(_.f)(o,e.previousIndex,e.currentIndex),n.componentInstance.loading="Updating zone ordering...",t.item.storePendingChange("zones",o),t.item.save().then((function(){n.close(),t.unsub("confirm_ref")}),(function(e){n.componentInstance.loading=null,t._service.notifyError("Error reording zones. Error: ".concat(JSON.stringify(e.response||e.message||e)))}))}})))}}},{key:"removeZone",value:function(e){var t=this;if(e&&e.id){var n=this._dialog.open(O.b,Object.assign(Object.assign({},O.a),{data:{title:"Remove zone?",content:'<p>Are you sure you want remove zone "'.concat(e.name,'" from the system?</p>Configuration will be updated immediately.'),icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("confirm_ref",n.componentInstance.event.subscribe((function(i){"done"===i.reason&&(t.loading.emit(!0),t.item.storePendingChange("zones",t.item.zones.filter((function(t){return t!==e.id}))),t.item.save().then((function(i){t.loading.emit(!1),t.item=i,t._service.notifySuccess('Remove zone "'.concat(e.name,'" from system')),n.close(),t.unsub("confirm_ref")}),(function(i){t.loading.emit(!1),t._service.notifySuccess('Error removing "'.concat(e.name,'" from system. Error: ').concat(JSON.stringify(i.response||i.message||i))),n.close(),t.unsub("confirm_ref")})))})))}}},{key:"joinZone",value:function(){var e=this;if(this.new_zone)if(this.item.zones.indexOf(this.new_zone.id)<0){this.loading.emit(!0);var t=this._dialog.open(O.b,Object.assign(Object.assign({},O.a),{data:{title:"Add zone",content:'Add zone "'.concat(this.new_zone.name,'" to system "').concat(this.item.name,'"'),icon:{type:"icon",class:"backoffice-upload-to-cloud"}}}));this.subscription("confirm_ref",t.componentInstance.event.subscribe((function(n){"done"===n.reason?(t.componentInstance.loading="Adding zone to system...",e.item.storePendingChange("zones",Object(ct.i)([].concat(_toConsumableArray(e.item.zones),[e.new_zone.id]))),e.item.save().then((function(n){e.loading.emit(!1),e._service.notifySuccess('Added zone "'.concat(e.new_zone.name,'" to system')),e.item=n,e.loadZones(),t.close(),e.unsub("confirm_ref"),e.new_zone=null}),(function(n){t.componentInstance.loading=null,e.loading.emit(!1),e._service.notifyError('Error adding zone "'.concat(e.new_zone.name,'". Error: ').concat(JSON.stringify(n.response||n.message||n)))}))):e.loading.emit(!1)})))}else this._service.notifyInfo("The selected zone is already linked to this system")}},{key:"zone_service",get:function(){return this._service.Zones}}]),n}(R.a),gt.\u0275fac=function(e){return new(e||gt)(w.Rb(C.a),w.Rb(P.b))},gt.\u0275cmp=w.Lb({type:gt,selectors:[["system-zones"]],inputs:{item:"item"},outputs:{loading:"loading"},features:[w.Ab,w.Bb],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"settings"],[1,"select"],[1,"dropdown"],[3,"service","exclude","ngModel","ngModelChange"],["mat-button","",3,"disabled","tapped"],[4,"ngIf"],["class","info-block",4,"ngIf"],[1,"small"],[1,"name"],[1,"description"],["class","small",4,"ngIf"],["cdkDropList","",3,"cdkDropListDropped"],["cdkDrag","",4,"ngFor","ngForOf"],["cdkDrag",""],["cdkDragHandle","",1,"action","grab"],[1,"backoffice-select-arrows"],["routerLinkActive","router-link-active",3,"routerLink","matTooltip"],["class","placeholder","colspan","6",4,"cdkDragPlaceholder"],["mat-icon-button","",3,"tapped"],[1,"backoffice-trash"],["colspan","6",1,"placeholder"],[1,"info-block"],[1,"text"]],template:function(e,t){1&e&&w.Pc(0,ft,10,6,"div",0),2&e&&w.wc("ngIf",t.item)},directives:[f.m,pe.a,g.l,g.o,q.b,M.b,_.d,f.l,_.a,_.b,p.f,p.e,ve.a,_.c],styles:[".container[_ngcontent-%COMP%]{padding:1em}header[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em}section[_ngcontent-%COMP%]{padding:.5em .25em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .25em 1.5em}.dropdown[_ngcontent-%COMP%]{flex:1}.placeholder[_ngcontent-%COMP%]{background:#ccc;border:3px dotted #999;min-height:3em;height:3em;transition:transform .25s cubic-bezier(0,0,.2,1)}.name[_ngcontent-%COMP%]{min-width:10em}.description[_ngcontent-%COMP%]{font-size:.8em;padding:.5em}"]}),gt)},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}],_t=n("PCNd");n.d(t,"AppSystemsModule",(function(){return vt}));var ht,vt=((ht=function e(){_classCallCheck(this,e)}).\u0275mod=w.Pb({type:ht}),ht.\u0275inj=w.Ob({factory:function(e){return new(e||ht)},imports:[[f.c,g.g,p.g.forChild(pt),_t.a,_.e]]}),ht)}}]);