function _templateObject14(){var e=_taggedTemplateLiteral([":@@systemTableEmpty\u241fedad99e460bba0d0256ef0624907d8d26d84595b\u241f5399503921552553899:No systems with trigger"]);return _templateObject14=function(){return e},e}function _templateObject13(){var e=_taggedTemplateLiteral([":@@systemTableAdded\u241f80e3b490720757978c99a7b5af3885faf202b955\u241f231679111972850796:Added"]);return _templateObject13=function(){return e},e}function _templateObject12(){var e=_taggedTemplateLiteral([":@@systemTableName\u241fcff1428d10d59d14e45edec3c735a27b5482db59\u241f8953033926734869941:Name"]);return _templateObject12=function(){return e},e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _templateObject11(){var e=_taggedTemplateLiteral([":@@triggerActionsEmpty\u241f71cb74873d6a75ae16e84e75d6249a79bbe1c505\u241f3814611805731914236:No actions for trigger"]);return _templateObject11=function(){return e},e}function _templateObject10(){var e=_taggedTemplateLiteral([":@@triggerConditionsEmpty\u241f653b5ca90ecf78dcc8c860e03ffb38be6f5c8bee\u241f1315028183848030960:No condtions for trigger"]);return _templateObject10=function(){return e},e}function _templateObject9(){var e=_taggedTemplateLiteral([":@@emailCountDisplay\u241f0999296882eee5cef69cbe222cf6f242c97a20f5\u241f468872276403073781:",":INTERPOLATION: ",":ICU:"]);return _templateObject9=function(){return e},e}function _templateObject8(){var e=_taggedTemplateLiteral([":\u241f6e542484e5a5b97451d8db2f7dfdbb6ae9882409\u241f3981906223455182500:{VAR_PLURAL, plural, =1 {Address } other {Addresses }}"]);return _templateObject8=function(){return e},e}function _templateObject7(){var e=_taggedTemplateLiteral([":@@triggerEmailsLabel\u241ffd50da1d6809d4560322a924221a854f1d21dc3b\u241f7098100161332510393:Email Actions"]);return _templateObject7=function(){return e},e}function _templateObject6(){var e=_taggedTemplateLiteral([":@@triggerFunctionsLabel\u241fbcd0d3c23fa6498d39bffabeec346417a572c40b\u241f3821303502506692310:Function Call Actions"]);return _templateObject6=function(){return e},e}function _templateObject5(){var e=_taggedTemplateLiteral([":@@triggerTimeLabel\u241fb8fd6c10ba159a3c30430f63820d801bfb7354f2\u241f2477713009538214942:Time Dependent Conditions"]);return _templateObject5=function(){return e},e}function _templateObject4(){var e=_taggedTemplateLiteral([":@@triggerComparisonLabel\u241fa5cf036084ee11326617b12304dbeefc6e1bb36a\u241f6551073590639857317:Variable Comparison Condtions"]);return _templateObject4=function(){return e},e}function _templateObject3(){var e=_taggedTemplateLiteral([":@@triggerActionsHeader\u241f030b4423b92167200e39519599f9b863b4f7c62c\u241f3193976279273491157:Actions"]);return _templateObject3=function(){return e},e}function _templateObject2(){var e=_taggedTemplateLiteral([":@@triggerConditionsHeader\u241f986668e81481d0fd0934b4ef56b4236ccb298712\u241f2079395509894825886:Conditions"]);return _templateObject2=function(){return e},e}function _templateObject(){var e=_taggedTemplateLiteral([":@@triggerTemplateSystemLabel\u241fe0756ac7c3aa344be20cf6e324a333ef5ff0466c\u241f2847369180436747415:Template System: "]);return _templateObject=function(){return e},e}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=_superPropBase(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{wKJ7:function(e,t,n){"use strict";n.r(t);var i,r,o,c,a,s,l=n("ofXK"),d=n("3Pt+"),u=n("tyNb"),m=n("5+WD"),b=n("mrSG"),f=n("THE0"),g=n("C/ya"),p=n("g+Po"),h=n("D/9M"),_=n("fXoL"),v=n("OaWH"),y=n("0IaG"),O=n("BAfr"),w=n("m6yr"),C=n("47y3"),P=function(){return{class:"backoffice-info-with-circle"}},x=function(e){return{id:"about",name:"About",icon:e}},j=function(){return{class:"backoffice-documents"}},k=function(e,t){return{id:"systems",name:"Systems",count:e,icon:t}},W=function(e,t){return[e,t]},M=((i=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,r,o){var c;return _classCallCheck(this,n),(c=t.call(this,e,i,r))._service=e,c._route=i,c._router=r,c._dialog=o,c.service=c._service.Triggers,c}return _createClass(n,[{key:"ngOnInit",value:function(){_get(_getPrototypeOf(n.prototype),"ngOnInit",this).call(this),this._service.title="Triggers"}},{key:"loadValues",value:function(){var e=this;this._service.Systems.query({offset:0,limit:1,trigger_id:this.item.id}).then((function(t){return e.system_count=e._service.Systems.last_total||t.length||0}))}},{key:"newItem",value:function(){var e=this;this.modal_ref||(this.modal_ref=this._dialog.open(h.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new f.q,service:this._service.Triggers}}),this.subscription("modal_events",this.modal_ref.componentInstance.event.subscribe((function(t){"done"===t.reason&&e._router.navigate(["/triggers",t.metadata.item.id])}))),this.modal_ref.afterClosed().subscribe((function(){e.unsub("modal_events"),e.modal_ref=null})))}},{key:"editItem",value:function(){var e=this;this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(h.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Triggers}}),this.modal_ref.afterClosed().subscribe((function(){e.unsub("modal_events"),e.modal_ref=null})))}},{key:"deleteItem",value:function(){var e=this;this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(p.b,Object.assign(Object.assign({},p.a),{data:{title:"Delete trigger",content:"<p>Are you sure you want delete this trigger?</p><p>Deleting this trigger will <strong>immediately</strong> remove it from all associated systems and zones</p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("modal_events",this.modal_ref.componentInstance.event.subscribe((function(t){return Object(b.b)(e,void 0,void 0,regeneratorRuntime.mark((function e(){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="done"===t.reason,!e.t0){e.next=8;break}return this.modal_ref.componentInstance.loading="Deleting trigger...",e.next=5,this.item.delete().catch((function(e){throw n.modal_ref.componentInstance.loading=null,n._service.notifyError("Error deleting trigger. Error: ".concat(JSON.stringify(e.response||e.message||e))),e}));case 5:this._router.navigate(["/triggers"]),this._service.set("BACKOFFICE.removed",this.item.id),this.modal_ref.close();case 8:case"end":return e.stop()}}),e,this)})))}))),this.modal_ref.afterClosed().subscribe((function(){e.unsub("modal_events"),e.modal_ref=null})))}}]),n}(g.a)).\u0275fac=function(e){return new(e||i)(_.Rb(v.a),_.Rb(u.a),_.Rb(u.c),_.Rb(y.b))},i.\u0275cmp=_.Lb({type:i,selectors:[["app-triggers"]],features:[_.Ab],decls:5,vars:17,consts:[[1,"container"],[1,"sidebar"],["heading","Triggers",3,"module","close","event"],[3,"touchrelease"],["name","trigger","route","triggers",3,"item","loading","tabs","event"]],template:function(e,t){1&e&&(_.Xb(0,"div",0),_.Xb(1,"div",1),_.Xb(2,"sidebar",2),_.mc("event",(function(e){return t.sidebarEvent(e)})),_.Wb(),_.Wb(),_.Xb(3,"main",3),_.mc("touchrelease",(function(){return t.show_sidebar=!1})),_.Xb(4,"item-display",4),_.mc("event",(function(e){return t.itemEvent(e)})),_.Wb(),_.Wb(),_.Wb()),2&e&&(_.Hb("show",t.show_sidebar),_.Db(2),_.wc("module",t.module)("close",t.show_sidebar),_.Db(2),_.wc("item",t.item)("loading",t.loading_item)("tabs",_.zc(14,W,_.yc(8,x,_.xc(7,P)),_.zc(11,k,t.system_count,_.xc(10,j)))))},directives:[O.a,w.b,C.a],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}@media only screen and (orientation:landscape) and (max-width:800px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;flex:1;background-color:#f0f0f0}@media only screen and (orientation:portrait) and (max-width:450px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}"]}),i),X=n("5f3J"),S=n("xQV9"),A=n("mrP1"),D=n("Qu3c"),T=n("GrRB"),I=n("bTqV"),R=n("0njA"),L=n("8r66");r=$localize(_templateObject()),o=$localize(_templateObject2()),c=$localize(_templateObject3()),a=$localize(_templateObject4()),s=$localize(_templateObject5());var E,$,q=function(){return{class:"backoffice-edit"}},z=function(){return{class:"backoffice-trash"}};function N(e,t){if(1&e){var n=_.Yb();_.Xb(0,"div",18),_.Sb(1,"div",19),_.Xb(2,"div",20),_.Rc(3),_.rc(4,"json"),_.rc(5,"json"),_.Wb(),_.Xb(6,"button",9),_.mc("tapped",(function(){_.Hc(n);var e=t.$implicit;return _.qc(3).editCondition(e)})),_.Sb(7,"app-icon",10),_.Wb(),_.Xb(8,"button",21),_.mc("tapped",(function(){_.Hc(n);var e=t.$implicit;return _.qc(3).confirmRemoveCondition(e)})),_.Sb(9,"app-icon",10),_.Wb(),_.Wb()}if(2&e){var i=t.$implicit,r=_.qc(3);_.Db(3),_.Vc(" ",_.sc(4,6,i.left)," ",i.operator," ",_.sc(5,8,i.right)," "),_.Db(3),_.wc("disabled",!r.template_system),_.Db(1),_.wc("icon",_.xc(10,q)),_.Db(2),_.wc("icon",_.xc(11,z))}}function H(e,t){if(1&e){var n=_.Yb();_.Xb(0,"div",18),_.Sb(1,"div",19),_.Xb(2,"div",20),_.Rc(3),_.Wb(),_.Xb(4,"button",9),_.mc("tapped",(function(){_.Hc(n);var e=t.$implicit;return _.qc(3).editCondition(e)})),_.Sb(5,"app-icon",10),_.Wb(),_.Xb(6,"button",21),_.mc("tapped",(function(){_.Hc(n);var e=t.$implicit;return _.qc(3).confirmRemoveCondition(e)})),_.Sb(7,"app-icon",10),_.Wb(),_.Wb()}if(2&e){var i=t.$implicit,r=_.qc(3);_.Db(3),_.Uc(" ","at"===i.type?"At time":"CRON"," ","at"===i.type?i.time:i.cron," "),_.Db(1),_.wc("disabled",!r.template_system),_.Db(1),_.wc("icon",_.xc(5,q)),_.Db(2),_.wc("icon",_.xc(6,z))}}function F(e,t){if(1&e&&(_.Xb(0,"div",13),_.Xb(1,"div",14),_.bc(2,a),_.Wb(),_.Xb(3,"div",15),_.Pc(4,N,10,12,"div",16),_.Wb(),_.Xb(5,"div",14),_.bc(6,s),_.Wb(),_.Xb(7,"div",17),_.Pc(8,H,8,7,"div",16),_.Wb(),_.Wb()),2&e){var n=_.qc(2);_.Db(4),_.wc("ngForOf",n.comparisons),_.Db(4),_.wc("ngForOf",n.time_dependents)}}function J(e,t){1&e&&_.Sb(0,"div",28)}E=$localize(_templateObject6()),$=$localize(_templateObject7());var B,V,K=function(){return{class:"backoffice-select-arrows"}};function Y(e,t){if(1&e){var n=_.Yb();_.Xb(0,"div",25),_.Xb(1,"div",26),_.Sb(2,"app-icon",10),_.Wb(),_.Xb(3,"div",20),_.Rc(4),_.rc(5,"json"),_.Wb(),_.Xb(6,"button",9),_.mc("tapped",(function(){_.Hc(n);var e=t.$implicit;return _.qc(3).editAction(e)})),_.Sb(7,"app-icon",10),_.Wb(),_.Xb(8,"button",21),_.mc("tapped",(function(){_.Hc(n);var e=t.$implicit;return _.qc(3).confirmRemoveAction(e)})),_.Sb(9,"app-icon",10),_.Wb(),_.Pc(10,J,1,0,"div",27),_.Wb()}if(2&e){var i=t.$implicit,r=_.qc(3);_.Db(2),_.wc("icon",_.xc(9,K)),_.Db(2),_.Vc(" ",i.mod,", ",i.method,"(",_.sc(5,7,i.args),") "),_.Db(2),_.wc("disabled",!r.template_system),_.Db(1),_.wc("icon",_.xc(10,q)),_.Db(2),_.wc("icon",_.xc(11,z))}}function Q(e,t){1&e&&_.Sb(0,"div",28)}function U(e,t){if(1&e){var n=_.Yb();_.Xb(0,"div",25),_.Xb(1,"div",26),_.Sb(2,"app-icon",10),_.Wb(),_.Xb(3,"div",20),_.Xb(4,"span",29),_.bc(5,V),_.rc(6,"formatList"),_.Wb(),_.Rc(7),_.Wb(),_.Xb(8,"button",9),_.mc("tapped",(function(){_.Hc(n);var e=t.$implicit;return _.qc(3).editAction(e)})),_.Sb(9,"app-icon",10),_.Wb(),_.Xb(10,"button",21),_.mc("tapped",(function(){_.Hc(n);var e=t.$implicit;return _.qc(3).confirmRemoveAction(e)})),_.Sb(11,"app-icon",10),_.Wb(),_.Pc(12,Q,1,0,"div",27),_.Wb()}if(2&e){var i=t.$implicit,r=_.qc(3);_.Db(2),_.wc("icon",_.xc(10,K)),_.Db(2),_.wc("matTooltip",_.sc(6,8,i.emails)),_.Db(2),_.fc(i.emails.length)(i.emails.length),_.cc(5),_.Db(1),_.Tc(" | Body Length: ",i.content.length," "),_.Db(1),_.wc("disabled",!r.template_system),_.Db(1),_.wc("icon",_.xc(11,q)),_.Db(2),_.wc("icon",_.xc(12,z))}}function G(e,t){if(1&e){var n=_.Yb();_.Xb(0,"div",13),_.Xb(1,"div",14),_.bc(2,E),_.Wb(),_.Xb(3,"div",22),_.mc("cdkDropListDropped",(function(e){return _.Hc(n),_.qc(2).confirmReorder("function",e)})),_.Pc(4,Y,11,12,"div",23),_.Wb(),_.Xb(5,"div",14),_.bc(6,$),_.Wb(),_.Xb(7,"div",24),_.mc("cdkDropListDropped",(function(e){return _.Hc(n),_.qc(2).confirmReorder("mailer",e)})),_.Pc(8,U,13,13,"div",23),_.Wb(),_.Wb()}if(2&e){var i=_.qc(2);_.Db(4),_.wc("ngForOf",i.functions),_.Db(4),_.wc("ngForOf",i.mailers)}}B=$localize(_templateObject8()),B=_.gc(B,{VAR_PLURAL:"\ufffd1\ufffd"}),V=$localize(_templateObject9(),"\ufffd0\ufffd",B);var Z,ee,te=function(){return{class:"backoffice-plus"}};function ne(e,t){if(1&e){var n=_.Yb();_.Xb(0,"div",3),_.Xb(1,"div",4),_.Xb(2,"section"),_.Xb(3,"div",5),_.Xb(4,"label",6),_.bc(5,r),_.Wb(),_.Xb(6,"item-search-field",7),_.mc("ngModelChange",(function(e){return _.Hc(n),_.qc().template_system=e})),_.Wb(),_.Wb(),_.Wb(),_.Xb(7,"header"),_.Xb(8,"div",8),_.Xb(9,"button",9),_.mc("tapped",(function(){return _.Hc(n),_.qc().addCondition()})),_.Sb(10,"app-icon",10),_.Wb(),_.Wb(),_.Xb(11,"div",11),_.bc(12,o),_.Wb(),_.Wb(),_.Xb(13,"section"),_.Pc(14,F,9,2,"div",12),_.Wb(),_.Xb(15,"header"),_.Xb(16,"div",8),_.Xb(17,"button",9),_.mc("tapped",(function(){return _.Hc(n),_.qc().addAction()})),_.Sb(18,"app-icon",10),_.Wb(),_.Wb(),_.Xb(19,"div",11),_.bc(20,c),_.Wb(),_.Wb(),_.Xb(21,"section"),_.Pc(22,G,9,2,"div",12),_.Wb(),_.Wb(),_.Wb()}if(2&e){var i=_.qc(),a=_.Ec(2),s=_.Ec(4);_.Db(6),_.wc("service",i.system_service)("ngModel",i.template_system),_.Db(3),_.wc("disabled",!i.template_system),_.Db(1),_.wc("icon",_.xc(10,te)),_.Db(4),_.wc("ngIf",i.comparisons.length||i.time_dependents.length)("ngIfElse",a),_.Db(3),_.wc("disabled",!i.template_system),_.Db(1),_.wc("icon",_.xc(11,te)),_.Db(4),_.wc("ngIf",i.functions.length||i.mailers.length)("ngIfElse",s)}}function ie(e,t){1&e&&(_.Xb(0,"div",30),_.Xb(1,"div",11),_.bc(2,Z),_.Wb(),_.Wb())}function re(e,t){1&e&&(_.Xb(0,"div",30),_.Xb(1,"div",11),_.bc(2,ee),_.Wb(),_.Wb())}Z=$localize(_templateObject10()),ee=$localize(_templateObject11());var oe,ce,ae,se=((oe=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i){var r;return _classCallCheck(this,n),(r=t.call(this))._service=e,r._dialog=i,r.comparisons=[],r.time_dependents=[],r.functions=[],r.mailers=[],r}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe((function(t){e.item=t,e.ngOnChanges({item:new _.K(null,e.item,!1)})})))}},{key:"ngOnChanges",value:function(e){e.item&&(this.item&&this.item.conditions&&(this.comparisons=this.item.conditions.comparisons||[],this.time_dependents=this.item.conditions.time_dependents||[],this.functions=this.item.actions.functions||[],this.mailers=this.item.actions.mailers||[]),this.confirm_ref&&(this.confirm_ref.close(),this.confirm_ref=null,this.unsub("delete_confirm")))}},{key:"addCondition",value:function(){this._dialog.open(A.a,{width:"auto",height:"auto",data:{trigger:this.item,system:this.template_system}})}},{key:"editCondition",value:function(e){this._dialog.open(A.a,{width:"auto",height:"auto",data:{trigger:this.item,condition:JSON.parse(JSON.stringify(e)),system:this.template_system}})}},{key:"addAction",value:function(){this._dialog.open(S.a,{data:{trigger:this.item,system:this.template_system}})}},{key:"editAction",value:function(e){this._dialog.open(S.a,{data:{trigger:this.item,action:e,system:this.template_system}})}},{key:"confirmRemoveCondition",value:function(e){var t=this;this.confirm_ref=this._dialog.open(p.b,Object.assign(Object.assign({},p.a),{data:{title:"Remove trigger condition",content:"<p>Are you sure you want remove this trigger condition?</p><p>All systems using this trigger will be updated <strong>immediately</strong>.</p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("delete_confirm",this.confirm_ref.componentInstance.event.subscribe((function(n){"done"===n.reason&&(t.confirm_ref.componentInstance.loading="Removing trigger condition...",t.removeCondition(e))})))}},{key:"removeCondition",value:function(e){var t=this,n={comparisons:_toConsumableArray(this.comparisons),time_dependents:_toConsumableArray(this.time_dependents)};if(e.type){var i=this.time_dependents.findIndex((function(t){return JSON.stringify(t)===JSON.stringify(e)}));n.time_dependents.splice(i,1)}else{var r=this.comparisons.findIndex((function(t){return JSON.stringify(t)===JSON.stringify(e)}));n.comparisons.splice(r,1)}this.item.storePendingChange("conditions",n),this.item.save().then((function(){return t._service.notifySuccess("Successfully removed trigger condition.")}),(function(e){return t._service.notifyError("Error removing trigger condition. Error: ".concat(JSON.stringify(e.response||e.message||e)))}))}},{key:"confirmRemoveAction",value:function(e){var t=this;this.confirm_ref=this._dialog.open(p.b,Object.assign(Object.assign({},p.a),{data:{title:"Remove trigger action",content:"<p>Are you sure you want remove this trigger action?</p><p>All systems using this trigger will be updated <strong>immediately</strong>.</p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("delete_confirm",this.confirm_ref.componentInstance.event.subscribe((function(n){"done"===n.reason&&(t.confirm_ref.componentInstance.loading="Removing trigger action...",t.removeAction(e))})))}},{key:"removeAction",value:function(e){var t=this,n={functions:_toConsumableArray(this.item.actions.functions),mailers:_toConsumableArray(this.item.actions.mailers)};if(e.emails){var i=this.mailers.findIndex((function(t){return JSON.stringify(t)===JSON.stringify(e)}));n.mailers.splice(i,1)}else{var r=this.functions.findIndex((function(t){return JSON.stringify(t)===JSON.stringify(e)}));n.functions.splice(r,1)}this.item.storePendingChange("actions",n),this.item.save().then((function(){return t._service.notifySuccess("Successfully removed trigger action.")}),(function(e){return t._service.notifyError("Error removing trigger action. Error: ".concat(JSON.stringify(e.response||e.message||e)))}))}},{key:"confirmReorder",value:function(e,t){var n=this;this.confirm_ref=this._dialog.open(p.b,Object.assign(Object.assign({},p.a),{data:{title:"Reoreder trigger ".concat(e," action"),content:"<p>Are you sure you want remove this trigger condition?</p><p>All systems using this trigger will be updated <strong>immediately</strong>.</p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("delete_confirm",this.confirm_ref.componentInstance.event.subscribe((function(i){"done"===i.reason&&(n.confirm_ref.componentInstance.loading="Reordering trigger ".concat(e," action..."),n.reorderAction(e,t))})))}},{key:"reorderAction",value:function(e,t){var n=this,i=_toConsumableArray("function"===e?this.functions:this.mailers);Object(m.f)(i,t.previousIndex,t.currentIndex),this.item.storePendingChange("actions",{functions:"function"===e?i:this.functions,mailers:"function"===e?this.mailers:i}),this.item.save().then((function(){return n._service.notifySuccess("Successfully re-ordered trigger ".concat(e," action."))}),(function(t){return n._service.notifyError("Error re-ordered trigger ".concat(e," action. Error: ").concat(JSON.stringify(t.response||t.message||t)))}))}},{key:"system_service",get:function(){return this._service.Systems}}]),n}(X.a)).\u0275fac=function(e){return new(e||oe)(_.Rb(v.a),_.Rb(y.b))},oe.\u0275cmp=_.Lb({type:oe,selectors:[["trigger-about"]],inputs:{item:"item"},features:[_.Ab,_.Bb],decls:5,vars:1,consts:[["class","container",4,"ngIf"],["no_conditions",""],["no_actions",""],[1,"container"],[1,"settings"],[1,"field"],["for","driver","matTooltip","System to use for available status variables and function calls"],[3,"service","ngModel","ngModelChange"],[1,"action"],["mat-icon-button","",3,"disabled","tapped"],[3,"icon"],[1,"text"],["class","list",4,"ngIf","ngIfElse"],[1,"list"],[1,"header"],[1,"group","comparisons"],["class","item",4,"ngFor","ngForOf"],[1,"group","time-dependents"],[1,"item"],[1,"handle"],[1,"details"],["mat-icon-button","",3,"tapped"],["cdkDropList","",1,"group","functions",3,"cdkDropListDropped"],["class","item","cdkDrag","",4,"ngFor","ngForOf"],["cdkDropList","",1,"group","emails",3,"cdkDropListDropped"],["cdkDrag","",1,"item"],["cdkDragHandle","",1,"handle"],["class","placeholder",4,"cdkDragPlaceholder"],[1,"placeholder"],[3,"matTooltip"],[1,"info-block"]],template:function(e,t){1&e&&(_.Pc(0,ne,23,12,"div",0),_.Pc(1,ie,3,0,"ng-template",null,1,_.Qc),_.Pc(3,re,3,0,"ng-template",null,2,_.Qc)),2&e&&_.wc("ngIf",t.item)},directives:[l.m,D.a,T.a,d.l,d.o,I.b,w.b,R.a,l.l,m.d,m.a,m.b,m.c],pipes:[l.g,L.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}header[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:700;font-size:1.1em}section[_ngcontent-%COMP%]{padding:.5em .25em}.no-item[_ngcontent-%COMP%]{font-size:.75em}.group[_ngcontent-%COMP%]{flex-direction:column}.group[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%}.item[_ngcontent-%COMP%]{border-radius:4px;margin:2px 0}.item[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:2.5rem;width:2.5rem}.item[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.item[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex:1;min-width:50%;white-space:nowrap;font-size:.6em;padding:0 .5rem;overflow:hidden;text-overflow:ellipsis}.item[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Fira Code,monospace}.item[_ngcontent-%COMP%]:nth-child(2n){background-color:#f0f0f0}.item[_ngcontent-%COMP%]:hover{background-color:#ccc}button[_ngcontent-%COMP%]{margin:.25em}header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .5em 0 0;border:1px solid rgba(0,0,0,.85)}header[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{border-color:#ccc}.header[_ngcontent-%COMP%]{padding:1em;font-size:1em;font-weight:500}.cdk-drag-preview[_ngcontent-%COMP%]{background-color:#fff;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 0 rgba(0,0,0,.12)}.cdk-drag-preview[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:none}.placeholder[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.1);border:4px dashed rgba(0,0,0,.6);height:3em;width:100%;border-radius:4px}"]}),oe),le=n("Cvi9"),de=n("oIn+");ce=$localize(_templateObject12()),ae=$localize(_templateObject13());var ue=function(e){return["/systems",e]};function me(e,t){if(1&e&&(_.Xb(0,"a",12),_.Rc(1),_.Wb()),2&e){var n=_.qc().$implicit;_.wc("routerLink",_.yc(3,ue,n.system_id))("matTooltip",n.system_id),_.Db(1),_.Tc(" ",n.system_name," ")}}var be,fe=function(){return{class:"backoffice-trash"}};function ge(e,t){if(1&e){var n=_.Yb();_.Xb(0,"tr"),_.Xb(1,"td",5),_.Sb(2,"div",8),_.Wb(),_.Xb(3,"td",6),_.Pc(4,me,2,5,"a",9),_.Wb(),_.Xb(5,"td"),_.Rc(6),_.rc(7,"dateFrom"),_.Wb(),_.Xb(8,"td",5),_.Xb(9,"button",10),_.mc("tapped",(function(){_.Hc(n);var e=t.$implicit;return _.qc(3).delete(e)})),_.Sb(10,"app-icon",11),_.Wb(),_.Wb(),_.Wb()}if(2&e){var i=t.$implicit;_.Db(2),_.Hb("active",i.enabled),_.Db(2),_.wc("ngIf",i.system_id),_.Db(2),_.Sc(_.sc(7,5,1e3*(i.created_at-0))),_.Db(4),_.wc("icon",_.xc(7,fe))}}function pe(e,t){if(1&e&&(_.Xb(0,"table"),_.Xb(1,"thead"),_.Sb(2,"td",5),_.Xb(3,"td",6),_.bc(4,ce),_.Wb(),_.Xb(5,"td",6),_.bc(6,ae),_.Wb(),_.Sb(7,"td",5),_.Wb(),_.Xb(8,"tbody"),_.Pc(9,ge,11,8,"tr",7),_.Wb(),_.Wb()),2&e){var n=_.qc(2);_.Db(9),_.wc("ngForOf",n.system_trigger_list)}}function he(e,t){if(1&e&&(_.Xb(0,"div",2),_.Xb(1,"div",3),_.Pc(2,pe,10,1,"table",4),_.Wb(),_.Wb()),2&e){var n=_.qc(),i=_.Ec(2);_.Db(2),_.wc("ngIf",n.system_trigger_list.length>0)("ngIfElse",i)}}function _e(e,t){1&e&&(_.Xb(0,"div",13),_.Xb(1,"div",14),_.bc(2,be),_.Wb(),_.Wb())}be=$localize(_templateObject14());var ve,ye=[{path:":id",component:M,children:[{path:"about",component:se},{path:"systems",component:(ve=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,r){var o;return _classCallCheck(this,n),(o=t.call(this))._service=e,o._dialog=i,o._composer=r,o.system_trigger_list=[],o.connected={},o}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe((function(t){e.item=t,e.ngOnChanges({item:new _.K(null,e.item,!1)})})))}},{key:"ngOnChanges",value:function(e){e.item&&this.item&&this.loadSystemTriggers()}},{key:"loadSystemTriggers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._service.Systems.query({trigger_id:this.item.id,offset:t}).then((function(t){return e.system_trigger_list=t||[]}),(function(){return null}))}},{key:"delete",value:function(e){var t=this;if(e){var n=this._dialog.open(p.b,Object.assign(Object.assign({},p.a),{data:{title:"Remove trigger",content:'<p>Are you sure you want remove this trigger?</p><p>Deleting this trigger will <strong>immediately</strong> remove from the system "'.concat(e.system_name||"",'"</p>'),icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",n.componentInstance.event.subscribe((function(i){return Object(b.b)(t,void 0,void 0,regeneratorRuntime.mark((function t(){var r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0="done"===i.reason,!t.t0){t.next=8;break}return n.componentInstance.loading="Removing trigger...",t.next=5,this.deleteTrigger(e).catch((function(e){throw n.componentInstance.loading=null,r._service.notifyError("Error removing trigger. Error: ".concat(JSON.stringify(e.response||e.message||e))),e}));case 5:this.loadSystemTriggers(),n.close(),this.unsub("delete_confirm");case 8:case"end":return t.stop()}}),t,this)})))})))}}},{key:"deleteTrigger",value:function(e){var t=this;return new Promise((function(n,i){t._composer.http.delete("".concat(t._composer.auth.api_endpoint,"/systems/").concat(e.system_id,"/triggers/").concat(e.id)).subscribe((function(e){return null}),(function(e){return i(e)}),(function(){return n()}))}))}}]),n}(X.a),ve.\u0275fac=function(e){return new(e||ve)(_.Rb(v.a),_.Rb(y.b),_.Rb(le.c))},ve.\u0275cmp=_.Lb({type:ve,selectors:[["trigger-systems"]],inputs:{item:"item"},features:[_.Ab,_.Bb],decls:3,vars:1,consts:[["class","container",4,"ngIf"],["empty_state",""],[1,"container"],[1,"settings"],[4,"ngIf","ngIfElse"],[1,"small"],[1,"flex"],[4,"ngFor","ngForOf"],[1,"state"],[3,"routerLink","matTooltip",4,"ngIf"],["mat-icon-button","",3,"tapped"],[3,"icon"],[3,"routerLink","matTooltip"],[1,"info-block"],[1,"text"]],template:function(e,t){1&e&&(_.Pc(0,he,3,2,"div",0),_.Pc(1,_e,3,0,"ng-template",null,1,_.Qc)),2&e&&_.wc("ngIf",t.item)},directives:[l.m,l.l,I.b,w.b,R.a,u.f,D.a],pipes:[de.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.list[_ngcontent-%COMP%]{margin-top:.5em}tbody[_ngcontent-%COMP%]{font-size:.9em}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap}div[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{width:2em}div[_ngcontent-%COMP%]   .duo[_ngcontent-%COMP%]{width:4em}div[_ngcontent-%COMP%]   .duo[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{display:inline-flex}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#d32f2f;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center}.select[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex:1}"]}),ve)},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}],Oe=n("PCNd");n.d(t,"AppTriggersModule",(function(){return Ce}));var we,Ce=((we=function e(){_classCallCheck(this,e)}).\u0275mod=_.Pb({type:we}),we.\u0275inj=_.Ob({factory:function(e){return new(e||we)},imports:[[l.c,d.g,u.g.forChild(ye),Oe.a,m.e]]}),we)}}]);