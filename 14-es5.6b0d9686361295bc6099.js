function _templateObject16(){var e=_taggedTemplateLiteral([":@@systemTableEmpty\u241fedad99e460bba0d0256ef0624907d8d26d84595b\u241f5399503921552553899:No systems with trigger"]);return _templateObject16=function(){return e},e}function _templateObject15(){var e=_taggedTemplateLiteral([":@@systemTableAdded\u241f80e3b490720757978c99a7b5af3885faf202b955\u241f231679111972850796:Added"]);return _templateObject15=function(){return e},e}function _templateObject14(){var e=_taggedTemplateLiteral([":@@systemTableName\u241fcff1428d10d59d14e45edec3c735a27b5482db59\u241f8953033926734869941:Name"]);return _templateObject14=function(){return e},e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _templateObject13(){var e=_taggedTemplateLiteral([":@@triggerActionsEmpty\u241f71cb74873d6a75ae16e84e75d6249a79bbe1c505\u241f3814611805731914236:No actions for trigger"]);return _templateObject13=function(){return e},e}function _templateObject12(){var e=_taggedTemplateLiteral([":@@triggerConditionsEmpty\u241f653b5ca90ecf78dcc8c860e03ffb38be6f5c8bee\u241f1315028183848030960:No condtions for trigger"]);return _templateObject12=function(){return e},e}function _templateObject11(){var e=_taggedTemplateLiteral([":@@emailCountDisplay\u241f0999296882eee5cef69cbe222cf6f242c97a20f5\u241f468872276403073781:",":INTERPOLATION: ",":ICU:"]);return _templateObject11=function(){return e},e}function _templateObject10(){var e=_taggedTemplateLiteral([":\u241f6e542484e5a5b97451d8db2f7dfdbb6ae9882409\u241f3981906223455182500:{VAR_PLURAL, plural, =1 {Address } other {Addresses }}"]);return _templateObject10=function(){return e},e}function _templateObject9(){var e=_taggedTemplateLiteral([":@@triggerEmailsLabel\u241ffd50da1d6809d4560322a924221a854f1d21dc3b\u241f7098100161332510393:Email Actions"]);return _templateObject9=function(){return e},e}function _templateObject8(){var e=_taggedTemplateLiteral([":@@triggerFunctionsLabel\u241fbcd0d3c23fa6498d39bffabeec346417a572c40b\u241f3821303502506692310:Function Call Actions"]);return _templateObject8=function(){return e},e}function _templateObject7(){var e=_taggedTemplateLiteral([":@@triggerTimeLabel\u241fb8fd6c10ba159a3c30430f63820d801bfb7354f2\u241f2477713009538214942:Time Dependent Conditions"]);return _templateObject7=function(){return e},e}function _templateObject6(){var e=_taggedTemplateLiteral([":@@triggerComparisonLabel\u241fa5cf036084ee11326617b12304dbeefc6e1bb36a\u241f6551073590639857317:Variable Comparison Condtions"]);return _templateObject6=function(){return e},e}function _templateObject5(){var e=_taggedTemplateLiteral([":@triggerUpdatedAtLabel\u241ff94240161f912dbd8758b858877cddeab80f36cb\u241f1116759395536210856:Updated:"]);return _templateObject5=function(){return e},e}function _templateObject4(){var e=_taggedTemplateLiteral([":@@triggerCreatedAtLabel\u241fa5ed099ffc9e96f6970df843289ade8a7d20ab9f\u241f1616250945945379783:Created:"]);return _templateObject4=function(){return e},e}function _templateObject3(){var e=_taggedTemplateLiteral([":@@triggerActionsHeader\u241f030b4423b92167200e39519599f9b863b4f7c62c\u241f3193976279273491157:Actions"]);return _templateObject3=function(){return e},e}function _templateObject2(){var e=_taggedTemplateLiteral([":@@triggerConditionsHeader\u241f986668e81481d0fd0934b4ef56b4236ccb298712\u241f2079395509894825886:Conditions"]);return _templateObject2=function(){return e},e}function _templateObject(){var e=_taggedTemplateLiteral([":@@triggerTemplateSystemLabel\u241fe0756ac7c3aa344be20cf6e324a333ef5ff0466c\u241f2847369180436747415:Template System: "]);return _templateObject=function(){return e},e}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=_superPropBase(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{wKJ7:function(e,t,n){"use strict";n.r(t);var i,r,o,c,a,s,l,d,b=n("ofXK"),m=n("3Pt+"),u=n("tyNb"),f=n("5+WD"),g=n("mrSG"),p=n("THE0"),h=n("C/ya"),_=n("g+Po"),v=n("D/9M"),y=n("fXoL"),O=n("OaWH"),C=n("0IaG"),w=n("BAfr"),P=n("m6yr"),j=n("47y3"),x=function(){return{class:"backoffice-info-with-circle"}},W=function(e){return{id:"about",name:"About",icon:e}},M=function(){return{class:"backoffice-documents"}},k=function(e,t){return{id:"systems",name:"Systems",count:e,icon:t}},X=function(e,t){return[e,t]},S=((i=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,r,o){var c;return _classCallCheck(this,n),(c=t.call(this,e,i,r))._service=e,c._route=i,c._router=r,c._dialog=o,c.service=c._service.Triggers,c}return _createClass(n,[{key:"ngOnInit",value:function(){_get(_getPrototypeOf(n.prototype),"ngOnInit",this).call(this),this._service.title="Triggers"}},{key:"loadValues",value:function(){var e=this;this._service.Systems.query({offset:0,limit:1,trigger_id:this.item.id}).then((function(t){return e.system_count=e._service.Systems.last_total||t.length||0}))}},{key:"newItem",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.modal_ref||(this.modal_ref=this._dialog.open(v.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:t?new p.q(Object.assign(Object.assign({},this.item),{id:"",name:"".concat(this.item.name," (1)")})):new p.q,service:this._service.Triggers}}),this.subscription("modal_events",this.modal_ref.componentInstance.event.subscribe((function(t){"done"===t.reason&&e._router.navigate(["/triggers",t.metadata.item.id])}))),this.modal_ref.afterClosed().subscribe((function(){e.unsub("modal_events"),e.modal_ref=null})))}},{key:"editItem",value:function(){var e=this;this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(v.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Triggers}}),this.modal_ref.afterClosed().subscribe((function(){e.unsub("modal_events"),e.modal_ref=null})))}},{key:"deleteItem",value:function(){var e=this;this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(_.b,Object.assign(Object.assign({},_.a),{data:{title:"Delete trigger",content:"<p>Are you sure you want delete this trigger?</p><p>Deleting this trigger will <strong>immediately</strong> remove it from all associated systems and zones</p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("modal_events",this.modal_ref.componentInstance.event.subscribe((function(t){return Object(g.b)(e,void 0,void 0,regeneratorRuntime.mark((function e(){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="done"===t.reason,!e.t0){e.next=8;break}return this.modal_ref.componentInstance.loading="Deleting trigger...",e.next=5,this.item.delete().catch((function(e){throw n.modal_ref.componentInstance.loading=null,n._service.notifyError("Error deleting trigger. Error: ".concat(JSON.stringify(e.response||e.message||e))),e}));case 5:this._router.navigate(["/triggers"]),this._service.set("BACKOFFICE.removed",this.item.id),this.modal_ref.close();case 8:case"end":return e.stop()}}),e,this)})))}))),this.modal_ref.afterClosed().subscribe((function(){e.unsub("modal_events"),e.modal_ref=null})))}}]),n}(h.a)).\u0275fac=function(e){return new(e||i)(y.Rb(O.a),y.Rb(u.a),y.Rb(u.c),y.Rb(C.b))},i.\u0275cmp=y.Lb({type:i,selectors:[["app-triggers"]],features:[y.Ab],decls:5,vars:17,consts:[[1,"container"],[1,"sidebar"],["heading","Triggers",3,"module","close","event"],[3,"touchrelease"],["name","trigger","route","triggers",3,"item","loading","tabs","event"]],template:function(e,t){1&e&&(y.Xb(0,"div",0),y.Xb(1,"div",1),y.Xb(2,"sidebar",2),y.mc("event",(function(e){return t.sidebarEvent(e)})),y.Wb(),y.Wb(),y.Xb(3,"main",3),y.mc("touchrelease",(function(){return t.show_sidebar=!1})),y.Xb(4,"item-display",4),y.mc("event",(function(e){return t.itemEvent(e)})),y.Wb(),y.Wb(),y.Wb()),2&e&&(y.Hb("show",t.show_sidebar),y.Db(2),y.wc("module",t.module)("close",t.show_sidebar),y.Db(2),y.wc("item",t.item)("loading",t.loading_item)("tabs",y.zc(14,X,y.yc(8,W,y.xc(7,x)),y.zc(11,k,t.system_count,y.xc(10,M)))))},directives:[w.a,P.b,j.a],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}@media only screen and (orientation:landscape) and (max-width:800px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;flex:1;background-color:#f0f0f0}@media only screen and (orientation:portrait) and (max-width:450px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}"]}),i),D=n("5f3J"),A=n("xQV9"),I=n("mrP1"),T=n("Qu3c"),R=n("GrRB"),L=n("bTqV"),E=n("0njA"),$=n("oIn+"),q=n("8r66");function z(e,t){if(1&e&&(y.Xb(0,"div",7),y.Xb(1,"label"),y.bc(2,a),y.Wb(),y.Xb(3,"div",15),y.Rc(4),y.rc(5,"dateFrom"),y.Wb(),y.Wb()),2&e){var n=y.qc(2);y.Db(4),y.Sc(y.sc(5,1,1e3*n.item.created_at))}}function N(e,t){if(1&e&&(y.Xb(0,"div",7),y.Xb(1,"label"),y.bc(2,s),y.Wb(),y.Xb(3,"div",15),y.Rc(4),y.rc(5,"dateFrom"),y.Wb(),y.Wb()),2&e){var n=y.qc(2);y.Db(4),y.Sc(y.sc(5,1,1e3*n.item.updated_at))}}r=$localize(_templateObject()),o=$localize(_templateObject2()),c=$localize(_templateObject3()),a=$localize(_templateObject4()),s=$localize(_templateObject5()),l=$localize(_templateObject6()),d=$localize(_templateObject7());var H,F,J=function(){return{class:"backoffice-edit"}},B=function(){return{class:"backoffice-trash"}};function V(e,t){if(1&e){var n=y.Yb();y.Xb(0,"div",21),y.Sb(1,"div",22),y.Xb(2,"div",4),y.Rc(3),y.rc(4,"json"),y.rc(5,"json"),y.Wb(),y.Xb(6,"button",11),y.mc("tapped",(function(){y.Hc(n);var e=t.$implicit;return y.qc(3).editCondition(e)})),y.Sb(7,"app-icon",12),y.Wb(),y.Xb(8,"button",23),y.mc("tapped",(function(){y.Hc(n);var e=t.$implicit;return y.qc(3).confirmRemoveCondition(e)})),y.Sb(9,"app-icon",12),y.Wb(),y.Wb()}if(2&e){var i=t.$implicit,r=y.qc(3);y.Db(3),y.Vc(" ",y.sc(4,6,i.left)," ",i.operator," ",y.sc(5,8,i.right)," "),y.Db(3),y.wc("disabled",!r.template_system),y.Db(1),y.wc("icon",y.xc(10,J)),y.Db(2),y.wc("icon",y.xc(11,B))}}function K(e,t){if(1&e){var n=y.Yb();y.Xb(0,"div",21),y.Sb(1,"div",22),y.Xb(2,"div",4),y.Rc(3),y.Wb(),y.Xb(4,"button",11),y.mc("tapped",(function(){y.Hc(n);var e=t.$implicit;return y.qc(3).editCondition(e)})),y.Sb(5,"app-icon",12),y.Wb(),y.Xb(6,"button",23),y.mc("tapped",(function(){y.Hc(n);var e=t.$implicit;return y.qc(3).confirmRemoveCondition(e)})),y.Sb(7,"app-icon",12),y.Wb(),y.Wb()}if(2&e){var i=t.$implicit,r=y.qc(3);y.Db(3),y.Uc(" ","at"===i.type?"At time":"CRON"," ","at"===i.type?i.time:i.cron," "),y.Db(1),y.wc("disabled",!r.template_system),y.Db(1),y.wc("icon",y.xc(5,J)),y.Db(2),y.wc("icon",y.xc(6,B))}}function U(e,t){if(1&e&&(y.Xb(0,"div",16),y.Xb(1,"div",17),y.bc(2,l),y.Wb(),y.Xb(3,"div",18),y.Pc(4,V,10,12,"div",19),y.Wb(),y.Xb(5,"div",17),y.bc(6,d),y.Wb(),y.Xb(7,"div",20),y.Pc(8,K,8,7,"div",19),y.Wb(),y.Wb()),2&e){var n=y.qc(2);y.Db(4),y.wc("ngForOf",n.comparisons),y.Db(4),y.wc("ngForOf",n.time_dependents)}}function Y(e,t){1&e&&y.Sb(0,"div",30)}H=$localize(_templateObject8()),F=$localize(_templateObject9());var Q,G,Z=function(){return{class:"backoffice-select-arrows"}};function ee(e,t){if(1&e){var n=y.Yb();y.Xb(0,"div",27),y.Xb(1,"div",28),y.Sb(2,"app-icon",12),y.Wb(),y.Xb(3,"div",4),y.Rc(4),y.rc(5,"json"),y.Wb(),y.Xb(6,"button",11),y.mc("tapped",(function(){y.Hc(n);var e=t.$implicit;return y.qc(3).editAction(e)})),y.Sb(7,"app-icon",12),y.Wb(),y.Xb(8,"button",23),y.mc("tapped",(function(){y.Hc(n);var e=t.$implicit;return y.qc(3).confirmRemoveAction(e)})),y.Sb(9,"app-icon",12),y.Wb(),y.Pc(10,Y,1,0,"div",29),y.Wb()}if(2&e){var i=t.$implicit,r=y.qc(3);y.Db(2),y.wc("icon",y.xc(9,Z)),y.Db(2),y.Vc(" ",i.mod,", ",i.method,"(",y.sc(5,7,i.args),") "),y.Db(2),y.wc("disabled",!r.template_system),y.Db(1),y.wc("icon",y.xc(10,J)),y.Db(2),y.wc("icon",y.xc(11,B))}}function te(e,t){1&e&&y.Sb(0,"div",30)}function ne(e,t){if(1&e){var n=y.Yb();y.Xb(0,"div",27),y.Xb(1,"div",28),y.Sb(2,"app-icon",12),y.Wb(),y.Xb(3,"div",4),y.Xb(4,"span",31),y.bc(5,G),y.rc(6,"formatList"),y.Wb(),y.Rc(7),y.Wb(),y.Xb(8,"button",11),y.mc("tapped",(function(){y.Hc(n);var e=t.$implicit;return y.qc(3).editAction(e)})),y.Sb(9,"app-icon",12),y.Wb(),y.Xb(10,"button",23),y.mc("tapped",(function(){y.Hc(n);var e=t.$implicit;return y.qc(3).confirmRemoveAction(e)})),y.Sb(11,"app-icon",12),y.Wb(),y.Pc(12,te,1,0,"div",29),y.Wb()}if(2&e){var i=t.$implicit,r=y.qc(3);y.Db(2),y.wc("icon",y.xc(10,Z)),y.Db(2),y.wc("matTooltip",y.sc(6,8,i.emails)),y.Db(2),y.fc(i.emails.length)(i.emails.length),y.cc(5),y.Db(1),y.Tc(" | Body Length: ",i.content.length," "),y.Db(1),y.wc("disabled",!r.template_system),y.Db(1),y.wc("icon",y.xc(11,J)),y.Db(2),y.wc("icon",y.xc(12,B))}}function ie(e,t){if(1&e){var n=y.Yb();y.Xb(0,"div",16),y.Xb(1,"div",17),y.bc(2,H),y.Wb(),y.Xb(3,"div",24),y.mc("cdkDropListDropped",(function(e){return y.Hc(n),y.qc(2).confirmReorder("function",e)})),y.Pc(4,ee,11,12,"div",25),y.Wb(),y.Xb(5,"div",17),y.bc(6,F),y.Wb(),y.Xb(7,"div",26),y.mc("cdkDropListDropped",(function(e){return y.Hc(n),y.qc(2).confirmReorder("mailer",e)})),y.Pc(8,ne,13,13,"div",25),y.Wb(),y.Wb()}if(2&e){var i=y.qc(2);y.Db(4),y.wc("ngForOf",i.functions),y.Db(4),y.wc("ngForOf",i.mailers)}}Q=$localize(_templateObject10()),Q=y.gc(Q,{VAR_PLURAL:"\ufffd1\ufffd"}),G=$localize(_templateObject11(),"\ufffd0\ufffd",Q);var re,oe,ce=function(){return{class:"backoffice-plus"}};function ae(e,t){if(1&e){var n=y.Yb();y.Xb(0,"div",3),y.Xb(1,"section",4),y.Pc(2,z,6,3,"div",5),y.Pc(3,N,6,3,"div",5),y.Wb(),y.Sb(4,"hr"),y.Xb(5,"div",6),y.Xb(6,"section"),y.Xb(7,"div",7),y.Xb(8,"label",8),y.bc(9,r),y.Wb(),y.Xb(10,"item-search-field",9),y.mc("ngModelChange",(function(e){return y.Hc(n),y.qc().template_system=e})),y.Wb(),y.Wb(),y.Wb(),y.Xb(11,"header"),y.Xb(12,"div",10),y.Xb(13,"button",11),y.mc("tapped",(function(){return y.Hc(n),y.qc().addCondition()})),y.Sb(14,"app-icon",12),y.Wb(),y.Wb(),y.Xb(15,"div",13),y.bc(16,o),y.Wb(),y.Wb(),y.Xb(17,"section"),y.Pc(18,U,9,2,"div",14),y.Wb(),y.Xb(19,"header"),y.Xb(20,"div",10),y.Xb(21,"button",11),y.mc("tapped",(function(){return y.Hc(n),y.qc().addAction()})),y.Sb(22,"app-icon",12),y.Wb(),y.Wb(),y.Xb(23,"div",13),y.bc(24,c),y.Wb(),y.Wb(),y.Xb(25,"section"),y.Pc(26,ie,9,2,"div",14),y.Wb(),y.Wb(),y.Wb()}if(2&e){var i=y.qc(),a=y.Ec(2),s=y.Ec(4);y.Db(2),y.wc("ngIf",i.item.created_at),y.Db(1),y.wc("ngIf",i.item.updated_at),y.Db(7),y.wc("service",i.system_service)("ngModel",i.template_system),y.Db(3),y.wc("disabled",!i.template_system),y.Db(1),y.wc("icon",y.xc(12,ce)),y.Db(4),y.wc("ngIf",i.comparisons.length||i.time_dependents.length)("ngIfElse",a),y.Db(3),y.wc("disabled",!i.template_system),y.Db(1),y.wc("icon",y.xc(13,ce)),y.Db(4),y.wc("ngIf",i.functions.length||i.mailers.length)("ngIfElse",s)}}function se(e,t){1&e&&(y.Xb(0,"div",32),y.Xb(1,"div",13),y.bc(2,re),y.Wb(),y.Wb())}function le(e,t){1&e&&(y.Xb(0,"div",32),y.Xb(1,"div",13),y.bc(2,oe),y.Wb(),y.Wb())}re=$localize(_templateObject12()),oe=$localize(_templateObject13());var de,be,me,ue=((de=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i){var r;return _classCallCheck(this,n),(r=t.call(this))._service=e,r._dialog=i,r.comparisons=[],r.time_dependents=[],r.functions=[],r.mailers=[],r}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe((function(t){e.item=t,e.ngOnChanges({item:new y.K(null,e.item,!1)})})))}},{key:"ngOnChanges",value:function(e){e.item&&(this.item&&this.item.conditions&&(this.comparisons=this.item.conditions.comparisons||[],this.time_dependents=this.item.conditions.time_dependents||[],this.functions=this.item.actions.functions||[],this.mailers=this.item.actions.mailers||[]),this.confirm_ref&&(this.confirm_ref.close(),this.confirm_ref=null,this.unsub("delete_confirm")))}},{key:"addCondition",value:function(){this._dialog.open(I.a,{width:"auto",height:"auto",data:{trigger:this.item,system:this.template_system}})}},{key:"editCondition",value:function(e){this._dialog.open(I.a,{width:"auto",height:"auto",data:{trigger:this.item,condition:JSON.parse(JSON.stringify(e)),system:this.template_system}})}},{key:"addAction",value:function(){this._dialog.open(A.a,{data:{trigger:this.item,system:this.template_system}})}},{key:"editAction",value:function(e){this._dialog.open(A.a,{data:{trigger:this.item,action:e,system:this.template_system}})}},{key:"confirmRemoveCondition",value:function(e){var t=this;this.confirm_ref=this._dialog.open(_.b,Object.assign(Object.assign({},_.a),{data:{title:"Remove trigger condition",content:"<p>Are you sure you want remove this trigger condition?</p><p>All systems using this trigger will be updated <strong>immediately</strong>.</p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("delete_confirm",this.confirm_ref.componentInstance.event.subscribe((function(n){"done"===n.reason&&(t.confirm_ref.componentInstance.loading="Removing trigger condition...",t.removeCondition(e))})))}},{key:"removeCondition",value:function(e){var t=this,n={comparisons:_toConsumableArray(this.comparisons),time_dependents:_toConsumableArray(this.time_dependents)};if(e.type){var i=this.time_dependents.findIndex((function(t){return JSON.stringify(t)===JSON.stringify(e)}));n.time_dependents.splice(i,1)}else{var r=this.comparisons.findIndex((function(t){return JSON.stringify(t)===JSON.stringify(e)}));n.comparisons.splice(r,1)}this.item.storePendingChange("conditions",n),this.item.save().then((function(){return t._service.notifySuccess("Successfully removed trigger condition.")}),(function(e){return t._service.notifyError("Error removing trigger condition. Error: ".concat(JSON.stringify(e.response||e.message||e)))}))}},{key:"confirmRemoveAction",value:function(e){var t=this;this.confirm_ref=this._dialog.open(_.b,Object.assign(Object.assign({},_.a),{data:{title:"Remove trigger action",content:"<p>Are you sure you want remove this trigger action?</p><p>All systems using this trigger will be updated <strong>immediately</strong>.</p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("delete_confirm",this.confirm_ref.componentInstance.event.subscribe((function(n){"done"===n.reason&&(t.confirm_ref.componentInstance.loading="Removing trigger action...",t.removeAction(e))})))}},{key:"removeAction",value:function(e){var t=this,n={functions:_toConsumableArray(this.item.actions.functions),mailers:_toConsumableArray(this.item.actions.mailers)};if(e.emails){var i=this.mailers.findIndex((function(t){return JSON.stringify(t)===JSON.stringify(e)}));n.mailers.splice(i,1)}else{var r=this.functions.findIndex((function(t){return JSON.stringify(t)===JSON.stringify(e)}));n.functions.splice(r,1)}this.item.storePendingChange("actions",n),this.item.save().then((function(){return t._service.notifySuccess("Successfully removed trigger action.")}),(function(e){return t._service.notifyError("Error removing trigger action. Error: ".concat(JSON.stringify(e.response||e.message||e)))}))}},{key:"confirmReorder",value:function(e,t){var n=this;this.confirm_ref=this._dialog.open(_.b,Object.assign(Object.assign({},_.a),{data:{title:"Reoreder trigger ".concat(e," action"),content:"<p>Are you sure you want remove this trigger condition?</p><p>All systems using this trigger will be updated <strong>immediately</strong>.</p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("delete_confirm",this.confirm_ref.componentInstance.event.subscribe((function(i){"done"===i.reason&&(n.confirm_ref.componentInstance.loading="Reordering trigger ".concat(e," action..."),n.reorderAction(e,t))})))}},{key:"reorderAction",value:function(e,t){var n=this,i=_toConsumableArray("function"===e?this.functions:this.mailers);Object(f.f)(i,t.previousIndex,t.currentIndex),this.item.storePendingChange("actions",{functions:"function"===e?i:this.functions,mailers:"function"===e?this.mailers:i}),this.item.save().then((function(){return n._service.notifySuccess("Successfully re-ordered trigger ".concat(e," action."))}),(function(t){return n._service.notifyError("Error re-ordered trigger ".concat(e," action. Error: ").concat(JSON.stringify(t.response||t.message||t)))}))}},{key:"system_service",get:function(){return this._service.Systems}}]),n}(D.a)).\u0275fac=function(e){return new(e||de)(y.Rb(O.a),y.Rb(C.b))},de.\u0275cmp=y.Lb({type:de,selectors:[["trigger-about"]],inputs:{item:"item"},features:[y.Ab,y.Bb],decls:5,vars:1,consts:[["class","container",4,"ngIf"],["no_conditions",""],["no_actions",""],[1,"container"],[1,"details"],["class","field",4,"ngIf"],[1,"settings"],[1,"field"],["for","driver","matTooltip","System to use for available status variables and function calls"],[3,"service","ngModel","ngModelChange"],[1,"action"],["mat-icon-button","",3,"disabled","tapped"],[3,"icon"],[1,"text"],["class","list",4,"ngIf","ngIfElse"],[1,"value"],[1,"list"],[1,"header"],[1,"group","comparisons"],["class","item",4,"ngFor","ngForOf"],[1,"group","time-dependents"],[1,"item"],[1,"handle"],["mat-icon-button","",3,"tapped"],["cdkDropList","",1,"group","functions",3,"cdkDropListDropped"],["class","item","cdkDrag","",4,"ngFor","ngForOf"],["cdkDropList","",1,"group","emails",3,"cdkDropListDropped"],["cdkDrag","",1,"item"],["cdkDragHandle","",1,"handle"],["class","placeholder",4,"cdkDragPlaceholder"],[1,"placeholder"],[3,"matTooltip"],[1,"info-block"]],template:function(e,t){1&e&&(y.Pc(0,ae,27,14,"div",0),y.Pc(1,se,3,0,"ng-template",null,1,y.Qc),y.Pc(3,le,3,0,"ng-template",null,2,y.Qc)),2&e&&y.wc("ngIf",t.item)},directives:[b.m,T.a,R.a,m.l,m.o,L.b,P.b,E.a,b.l,f.d,f.a,f.b,f.c],pipes:[$.a,b.g,q.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}header[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:700;font-size:1.1em}section[_ngcontent-%COMP%]{padding:.5em .25em}.no-item[_ngcontent-%COMP%]{font-size:.75em}.group[_ngcontent-%COMP%]{flex-direction:column}.group[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%}.item[_ngcontent-%COMP%]{border-radius:4px;margin:2px 0}.item[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:2.5rem;width:2.5rem}.item[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.item[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex:1;min-width:50%;white-space:nowrap;font-size:.6em;padding:0 .5rem;overflow:hidden;text-overflow:ellipsis}.item[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Fira Code,monospace}.item[_ngcontent-%COMP%]:nth-child(2n){background-color:#f0f0f0}.item[_ngcontent-%COMP%]:hover{background-color:#ccc}button[_ngcontent-%COMP%]{margin:.25em}header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .5em 0 0;border:1px solid rgba(0,0,0,.85)}header[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{border-color:#ccc}.header[_ngcontent-%COMP%]{padding:1em;font-size:1em;font-weight:500}.cdk-drag-preview[_ngcontent-%COMP%]{background-color:#fff;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 0 rgba(0,0,0,.12)}.cdk-drag-preview[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:none}.placeholder[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.1);border:4px dashed rgba(0,0,0,.6);height:3em;width:100%;border-radius:4px}.details[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{display:flex;align-items:center;margin:.25em 0}.details[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{padding:0 .5em;-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all}.details[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.8em;font-weight:500}"]}),de),fe=n("Cvi9");be=$localize(_templateObject14()),me=$localize(_templateObject15());var ge=function(e){return["/systems",e]};function pe(e,t){if(1&e&&(y.Xb(0,"a",12),y.Rc(1),y.Wb()),2&e){var n=y.qc().$implicit;y.wc("routerLink",y.yc(3,ge,n.id))("matTooltip",n.id),y.Db(1),y.Tc(" ",n.name," ")}}var he,_e=function(){return{class:"backoffice-trash"}};function ve(e,t){if(1&e){var n=y.Yb();y.Xb(0,"tr"),y.Xb(1,"td",5),y.Sb(2,"div",8),y.Wb(),y.Xb(3,"td",6),y.Pc(4,pe,2,5,"a",9),y.Wb(),y.Xb(5,"td"),y.Rc(6),y.rc(7,"dateFrom"),y.Wb(),y.Xb(8,"td",5),y.Xb(9,"button",10),y.mc("tapped",(function(){y.Hc(n);var e=t.$implicit;return y.qc(3).delete(e)})),y.Sb(10,"app-icon",11),y.Wb(),y.Wb(),y.Wb()}if(2&e){var i=t.$implicit;y.Db(2),y.Hb("active",i.bookable),y.Db(2),y.wc("ngIf",i.id),y.Db(2),y.Sc(y.sc(7,5,1e3*(i.created_at-0))),y.Db(4),y.wc("icon",y.xc(7,_e))}}function ye(e,t){if(1&e&&(y.Xb(0,"table"),y.Xb(1,"thead"),y.Sb(2,"td",5),y.Xb(3,"td",6),y.bc(4,be),y.Wb(),y.Xb(5,"td",6),y.bc(6,me),y.Wb(),y.Sb(7,"td",5),y.Wb(),y.Xb(8,"tbody"),y.Pc(9,ve,11,8,"tr",7),y.Wb(),y.Wb()),2&e){var n=y.qc(2);y.Db(9),y.wc("ngForOf",n.system_trigger_list)}}function Oe(e,t){if(1&e&&(y.Xb(0,"div",2),y.Xb(1,"div",3),y.Pc(2,ye,10,1,"table",4),y.Wb(),y.Wb()),2&e){var n=y.qc(),i=y.Ec(2);y.Db(2),y.wc("ngIf",n.system_trigger_list.length>0)("ngIfElse",i)}}function Ce(e,t){1&e&&(y.Xb(0,"div",13),y.Xb(1,"div",14),y.bc(2,he),y.Wb(),y.Wb())}he=$localize(_templateObject16());var we,Pe=[{path:":id",component:S,children:[{path:"about",component:ue},{path:"systems",component:(we=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,r){var o;return _classCallCheck(this,n),(o=t.call(this))._service=e,o._dialog=i,o._composer=r,o.system_trigger_list=[],o.connected={},o}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.subscription("item",this._service.listen("BACKOFFICE.active_item").subscribe((function(t){e.item=t,e.ngOnChanges({item:new y.K(null,e.item,!1)})})))}},{key:"ngOnChanges",value:function(e){e.item&&this.item&&this.loadSystemTriggers()}},{key:"loadSystemTriggers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._service.Systems.query({trigger_id:this.item.id,offset:t}).then((function(t){return e.system_trigger_list=t||[]}),(function(){return null}))}},{key:"delete",value:function(e){var t=this;if(e){var n=this._dialog.open(_.b,Object.assign(Object.assign({},_.a),{data:{title:"Remove trigger",content:'<p>Are you sure you want remove this trigger?</p><p>Deleting this trigger will <strong>immediately</strong> remove from the system "'.concat(e.system_name||"",'"</p>'),icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",n.componentInstance.event.subscribe((function(i){return Object(g.b)(t,void 0,void 0,regeneratorRuntime.mark((function t(){var r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0="done"===i.reason,!t.t0){t.next=8;break}return n.componentInstance.loading="Removing trigger...",t.next=5,this.deleteTrigger(e).catch((function(e){throw n.componentInstance.loading=null,r._service.notifyError("Error removing trigger. Error: ".concat(JSON.stringify(e.response||e.message||e))),e}));case 5:this.loadSystemTriggers(),n.close(),this.unsub("delete_confirm");case 8:case"end":return t.stop()}}),t,this)})))})))}}},{key:"deleteTrigger",value:function(e){var t=this;return new Promise((function(n,i){t._composer.http.delete("".concat(t._composer.auth.api_endpoint,"/systems/").concat(e.system_id,"/triggers/").concat(e.id)).subscribe((function(e){return null}),(function(e){return i(e)}),(function(){return n()}))}))}}]),n}(D.a),we.\u0275fac=function(e){return new(e||we)(y.Rb(O.a),y.Rb(C.b),y.Rb(fe.c))},we.\u0275cmp=y.Lb({type:we,selectors:[["trigger-systems"]],inputs:{item:"item"},features:[y.Ab,y.Bb],decls:3,vars:1,consts:[["class","container",4,"ngIf"],["empty_state",""],[1,"container"],[1,"settings"],[4,"ngIf","ngIfElse"],[1,"small"],[1,"flex"],[4,"ngFor","ngForOf"],[1,"state"],[3,"routerLink","matTooltip",4,"ngIf"],["mat-icon-button","",3,"tapped"],[3,"icon"],[3,"routerLink","matTooltip"],[1,"info-block"],[1,"text"]],template:function(e,t){1&e&&(y.Pc(0,Oe,3,2,"div",0),y.Pc(1,Ce,3,0,"ng-template",null,1,y.Qc)),2&e&&y.wc("ngIf",t.item)},directives:[b.m,b.l,L.b,P.b,E.a,u.f,T.a],pipes:[$.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.list[_ngcontent-%COMP%]{margin-top:.5em}tbody[_ngcontent-%COMP%]{font-size:.9em}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap}div[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{width:2em}div[_ngcontent-%COMP%]   .duo[_ngcontent-%COMP%]{width:4em}div[_ngcontent-%COMP%]   .duo[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{display:inline-flex}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#d32f2f;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center}.select[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex:1}"]}),we)},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}],je=n("PCNd");n.d(t,"AppTriggersModule",(function(){return We}));var xe,We=((xe=function e(){_classCallCheck(this,e)}).\u0275mod=y.Pb({type:xe}),xe.\u0275inj=y.Ob({factory:function(e){return new(e||xe)},imports:[[b.c,m.g,u.g.forChild(Pe),je.a,f.e]]}),xe)}}]);